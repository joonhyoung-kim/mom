!function(F,J){"use strict";var i="ht",r=i+".layout.",h=F[i]||module.parent.exports.ht,d=h.List,W=h.DataModel,L=h.Node,f=h.Edge,C=h.Group,g=Math,N=g.sqrt,B=g.random,p=g.max,n=g.min,z=function(n){return n*n};h.Default.getInternal().addMSMap({ms_force:function(V){V._interval=50,V._stepCount=10,V._motionLimit=.01,V._edgeRepulsion=.65,V._nodeRepulsion=.65,V._damper=1,V._maxMotion=0,V._motionRatio=0,V.init=function(Q){var w=this;Q instanceof W?w.dm=Q:w.gv=Q,w._nodeMap={},w._nodes=new d,w._edges=new d},V.start=function(){var o=this,N=o.gv;if(!o._timer){var t=o.cdm=N?N.dm():o.dm;t.mm(o.handleDataModelChange,o),t.md(o.handleDataPropertyChange,o),N&&N.mp(o.handleGV,o),t.each(function(C){if(o.isVisible(C)&&o.isLayoutable(C)&&C instanceof L)if(o instanceof j){var N=C.p3();C.p3([N[0]+B(),N[1]+B(),N[2]+B()])}else N=C.p(),C.p(N.x+B(),N.y+B())}),o._timer=setInterval(function(){o.relax()},o._interval),o._damper=1}},V.stop=function(){var i=this;i._timer&&(i.cdm.umm(i.handleDataModelChange,i),i.cdm.umd(i.handleDataPropertyChange,i),i.gv&&i.gv.ump(i.handleGV,i),clearInterval(i._timer),delete i._timer,delete i.cdm)},V.handleGV=function(T){var m=this;if("dataModel"===T.property){var W=T.oldValue,q=T.newValue;W&&(W.umm(m.handleDataModelChange,m),W.umd(m.handleDataPropertyChange,m)),this.cdm=q,q.mm(m.handleDataModelChange,m),q.md(m.handleDataPropertyChange,m)}},V.relax=function(){var g=this;if(!(g._damper<.1&&g._maxMotion<g._motionLimit)){this.cdm.each(function(n){g.isVisible(n)&&(n instanceof f?g.addEdge(n):n instanceof L&&g.addNode(n))});for(var N,H,a=0,R=g._edges,v=g._nodes,K=v.size();a<g._stepCount;a++){for(R.each(g.relaxEdge,g),N=0;K>N;N++)for(H=0;K>H;H++)g.relaxNode(v.get(N),v.get(H));g.moveNode()}g._isAdjusting=1,v.each(function(e){e.fix||(e.p?e.v.p3(e.p):e.v.p(e.x,e.y))}),delete g._isAdjusting,g._nodeMap={},v.clear(),R.clear(),g.onRelaxed()}},V.onRelaxed=function(){},V.isRunning=function(){return!!this._timer},V.isVisible=function(R){return R.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(R):!0},V.isLayoutable=function(z){if(z.s("layoutable")===!1)return!1;if(z instanceof C)return!1;var x=this;return x.gv?x.gv.isMovable(z)&&!x.gv.isSelected(z):!(x.cdm||x.dm).sm().co(z)},V.getNodeRepulsion=function(){return this._nodeRepulsion},V.setNodeRepulsion=function(g){this._nodeRepulsion=g,this._damper=1},V.getEdgeRepulsion=function(){return this._edgeRepulsion},V.setEdgeRepulsion=function(n){this._edgeRepulsion=n,this._damper=1},V.getStepCount=function(){return this._stepCount},V.setStepCount=function(m){this._stepCount=m,this._damper=1},V.getInterval=function(){return this._interval},V.setInterval=function(i){var t=this;t._interval!==i&&(t._interval=i,t._timer&&(clearInterval(t._timer),t._timer=setInterval(function(){t.relax()},i)))},V.handleDataPropertyChange=function(z){!this._isAdjusting&&this.isVisible(z.data)&&(this._damper=1)},V.handleDataModelChange=function(){this._damper=1},V.damp=function(){var z=this._maxMotion,F=this._damper;this._motionRatio<=.001&&((.2>z||z>1&&.9>F)&&F>.01?this._damper-=.01:.4>z&&F>.003?this._damper-=.003:F>1e-4&&(this._damper-=1e-4)),z<this._motionLimit&&(this._damper=0)}}}),h.layout.ForceLayout=function(X){this.init(X)},h.Default.def(r+"ForceLayout",J,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(Q){this._limitBounds=Q,this._damper=1},getNodeSize:function(P){var b=this.gv;return b&&b.getDataUIBounds?b.getDataUIBounds(P):P.getRect()},addNode:function(c){var j=this,d=j._nodeMap[c._id];if(d)return d;var W=c.p();d={v:c,x:W.x,y:W.y,dx:0,dy:0,fix:!j.isLayoutable(c),s:j.getNodeSize(c)};var $=d.s,Q=N(z($.width)+z($.height))*j._nodeRepulsion;return d.r=1>Q?100:Q,j._nodeMap[c._id]=d,j._nodes.add(d),d},addEdge:function(t){if(t._40I&&t._41I){var f=this,l=f.addNode(t._40I),x=f.addNode(t._41I),U={s:l,t:x};x=x.s,l=l.s;var $=x.width+l.width,K=x.height+l.height;U.length=N($*$+K*K)*f._edgeRepulsion,U.length<=0&&(U.length=100),f._edges.add(U)}},relaxEdge:function(S){var U=S.t,L=S.s,k=U.x-L.x,e=U.y-L.y,z=N(k*k+e*e),u=100*S.length,l=.25*k/u*z,v=.25*e/u*z;U.dx=U.dx-l,U.dy=U.dy-v,L.dx=L.dx+l,L.dy=L.dy+v},relaxNode:function(X,o){if(X!==o){var b=0,a=0,S=X.x-o.x,t=X.y-o.y,U=S*S+t*t;0===U?(b=B(),a=B()):36e4>U&&(b=S/U,a=t/U);var I=X.r*o.r/400;b*=I,a*=I,X.dx+=b,X.dy+=a,o.dx-=b,o.dy-=a}},moveNode:function(){var r=this,X=r._limitBounds,O=r._maxMotion,U=0,u=r._damper;r._nodes.each(function(O){if(!O.fix){var t=O.dx*u,i=O.dy*u;if(O.dx=t/2,O.dy=i/2,U=p(N(t*t+i*i),U),O.x+=p(-40,n(40,t)),O.y+=p(-40,n(40,i)),X){O.x<X.x&&(O.x=X.x,r.adjust(1,0)),O.y<X.y&&(O.y=X.y,r.adjust(0,1));var B=O.s;O.x+B.width>X.x+X.width&&(O.x=X.x+X.width-B.width,r.adjust(-1,0)),O.y+B.height>X.y+X.height&&(O.y=X.y+X.height-B.height,r.adjust(0,-1))}}}),r._maxMotion=U,r._motionRatio=U>0?O/U-1:0,r.damp()},adjust:function(c,r){var j=this._limitBounds;this._nodes.each(function(F){c>0?(!j||F.x+F.s.width+c<j.x+j.width)&&(F.x+=c):(!j||F.x+c>j.x)&&(F.x+=c),r>0?(!j||F.y+F.s.height+r<j.y+j.height)&&(F.y+=r):(!j||F.y+r>j.y)&&(F.y+=r)})}});var j=h.layout.Force3dLayout=function(s){this.init(s)};h.Default.def(r+"Force3dLayout",J,{ms_force:1,getNodeSize3d:function(e){return e.s3()},addNode:function(M){var q=this,G=q._nodeMap[M._id];if(G)return G;G={v:M,p:M.p3(),d:[0,0,0],fix:!q.isLayoutable(M),s:q.getNodeSize3d(M)};var v=G.s,d=h.Default.getDistance(v)*q._nodeRepulsion;return G.r=1>d?100:d,q._nodeMap[M._id]=G,q._nodes.add(G),G},addEdge:function(D){if(D._40I&&D._41I){var H=this,b=H.addNode(D._40I),K=H.addNode(D._41I),Q={s:b,t:K};K=K.s,b=b.s,Q.length=N(z(K[0]+b[0])+z(K[1]+b[1])+z(K[2]+b[2]))*H._edgeRepulsion,Q.length<=0&&(Q.length=100),H._edges.add(Q)}},relaxEdge:function(J){var v=J.t.p,W=J.s.p,S=J.t.d,a=J.s.d,E=v[0]-W[0],T=v[1]-W[1],u=v[2]-W[2],o=N(E*E+T*T+u*u),h=100*J.length,y=.25*E/h*o,i=.25*T/h*o,I=.25*u/h*o;S[0]-=y,S[1]-=i,S[2]-=I,a[0]+=y,a[1]+=i,a[2]+=I},relaxNode:function(s,g){if(s!==g){var u=s.p,n=g.p,w=0,C=0,i=0,f=u[0]-n[0],R=u[1]-n[1],U=u[2]-n[2],L=f*f+R*R+U*U;0===L?(w=B(),C=B(),i=B()):216e6>L&&(w=f/L,C=R/L,i=U/L);var T=s.r*g.r/400,q=s.d,o=g.d;w*=T,C*=T,i*=T,q[0]+=w,q[1]+=C,q[2]+=i,o[0]-=w,o[1]-=C,o[2]-=i}},moveNode:function(){var T=this,k=T._maxMotion,z=0,J=T._damper;T._nodes.each(function(t){if(!t.fix){var j=t.p,D=t.d,q=D[0]*J,E=D[1]*J,o=D[2]*J;D[0]=q/2,D[1]=E/2,D[2]=o/2,z=p(N(q*q+E*E+o*o),z),j[0]+=p(-40,n(40,q)),j[1]+=p(-40,n(40,E)),j[2]+=p(-40,n(40,o))}}),T._maxMotion=z,T._motionRatio=z>0?k/z-1:0,T.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);