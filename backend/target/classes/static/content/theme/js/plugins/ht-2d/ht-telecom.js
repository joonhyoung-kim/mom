!function(P,y){"use strict";var m=ht.AlarmSeverity=function(h,i,E,R,m){this.value=h,this.name=i,this.nickName=E,this.color=R,this.displayName=m};ht.Default.def("ht.AlarmSeverity",y,{toString:function(){return this.displayName||this.name}}),function(){m.severities=new ht.List,m._vm={},m._nm={},m._cp=function(w,W){if(w&&W){var G=w.value-W.value;return G>0?1:0>G?-1:0}return w&&!W?1:!w&&W?-1:0},m.each=function(O,N){m.severities.each(O,N)},m.getSortFunction=function(){return m._cp},m.setSortFunction=function(D){m._cp=D,m.severities.sort(D)},m.add=function(K,U,G,w,D){var I=new m(K,U,G,w,D);return m._vm[K]=I,m._nm[U]=I,m.severities.add(I),m.severities.sort(m._cp),I},m.remove=function(J){var N=m._nm[J];return N&&(delete m._nm[J],delete m._vm[N.value],m.severities.remove(N)),N},m.CRITICAL=m.add(500,"Critical","C","#FF0000"),m.MAJOR=m.add(400,"Major","M","#FFA000"),m.MINOR=m.add(300,"Minor","m","#FFFF00"),m.WARNING=m.add(200,"Warning","W","#00FFFF"),m.INDETERMINATE=m.add(100,"Indeterminate","N","#C800FF"),m.CLEARED=m.add(0,"Cleared","R","#00FF00"),m.isClearedAlarmSeverity=function(z){return z?0===z.value:!1},m.getByName=function(N){return m._nm[N]},m.getByValue=function(N){return m._vm[N]},m.clear=function(){m.severities.clear(),m._vm={},m._nm={}},m.compare=function(X,Z){return m._cp(X,Z)}}();var G=ht.AlarmState=function(M){this._d=M,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",y,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var q=null;for(var Z in this._am)Z=m.getByName(Z),m.isClearedAlarmSeverity(Z)||0!==this.getAcknowledgedAlarmCount(Z)&&(q=q?m.compare(q,Z)>0?q:Z:Z);this._haa=q},_c2:function(){var t=null;for(var z in this._nm)z=m.getByName(z),m.isClearedAlarmSeverity(z)||0!==this.getNewAlarmCount(z)&&(t=t?m.compare(t,z)>0?t:z:z);this._hna=t},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var y in this._nm)if(y=m.getByName(y),!m.isClearedAlarmSeverity(y)&&0!==this.getNewAlarmCount(y)&&m.compare(this._hna,y)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var H=this._haa,c=this._hna,S=this._ps;this._hoa=H,m.compare(c,this._hoa)>0&&(this._hoa=c),m.compare(S,this._hoa)>0&&(this._hoa=S)},_c5:function(){var c=this._haa,A=this._hna;this._hta=c,m.compare(A,this._hta)>0&&(this._hta=A)},increaseAcknowledgedAlarm:function(m,p){if(0!==p){p=p||1;var i=this._am[m.name]||0;i+=p,this._am[m.name]=i,this._f()}},increaseNewAlarm:function(p,L){if(0!==L){L=L||1;var d=this._nm[p.name]||0;d+=L,this._nm[p.name]=d,this._f()}},decreaseAcknowledgedAlarm:function(t,O){if(0!==O){O||(O=1);var G=this._am[t.name]||0;if(G-=O,0>G)throw"Alarm count can not be negative";this._am[t.name]=G,this._f()}},decreaseNewAlarm:function(Y,s){if(0!==s){s||(s=1);var D=this._nm[Y.name]||0;if(D-=s,0>D)throw"Alarm count can not be negative";this._nm[Y.name]=D,this._f()}},acknowledgeAlarm:function(e){this.decreaseNewAlarm(e,1),this.increaseAcknowledgedAlarm(e,1)},acknowledgeAllAlarms:function(Z){if(Z){var n=this.getNewAlarmCount(Z);this.decreaseNewAlarm(Z,n),this.increaseAcknowledgedAlarm(Z,n)}else for(var X in this._nm)this.acknowledgeAllAlarms(m.getByName(X))},_c6:function(){this._aac=0;for(var I in this._am)I=m.getByName(I),this._aac+=this.getAcknowledgedAlarmCount(I)},getAcknowledgedAlarmCount:function(a){return a?this._am[a.name]||0:this._aac},getAlarmCount:function(Y){return this.getAcknowledgedAlarmCount(Y)+this.getNewAlarmCount(Y)},_c7:function(){this._nac=0;for(var Z in this._nm)this._nac+=this.getNewAlarmCount(m.getByName(Z))},getNewAlarmCount:function(J){return J?this._nm[J.name]||0:this._nac},setNewAlarmCount:function(p,y){this._nm[p.name]=y,this._f()},removeAllNewAlarms:function(A){A?delete this._nm[A]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(j,G){this._am[j.name]=G,this._f()},removeAllAcknowledgedAlarms:function(H){H?delete this._am[H.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(N){if(this._ep||(N=null),this._ps!==N){var o=this._ps;this._ps=N,this._f(),this._d.fp("propagateSeverity",o,N)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(p){var Z=this._ep;this._ep=p,this._d.fp("enablePropagation",Z,p)&&(p||this.setPropagateSeverity(null))}});var e=ht.AlarmStatePropagator=function(v){this._dataModel=v,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",y,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(I){this._enable!==I&&(this._enable=I,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(L){this.propagate(L)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(f){f.data&&this.propagate(f.data)},handleDataPropertyChange:function(Y){if("alarmState"===Y.property||"enablePropagation"===Y.property)this.propagate(Y.data);else if("parent"===Y.property){var r=Y.oldValue;r&&this.propagate(r),this.propagate(Y.data)}},propagate:function(M){M&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(M),this._isPropagating=!1)},propagateToTop:function(N){for(this.propagateToParent(null,N);N&&N.getParent();)this.propagateToParent(N,N.getParent()),N=N.getParent()},propagateToParent:function(X,b){var g=null;b.getChildren().each(function(T){var b=T.getAlarmState().getHighestOverallAlarmSeverity();m.compare(b,g)>0&&(g=b)}),b.getAlarmState().setPropagateSeverity(g)}}),ht.AlarmStateStatistics=function(c){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(c)},ht.Default.def("ht.AlarmStateStatistics",y,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(R){var o=this._dataModel;o!==R&&(o&&(o.umd(this.handleDataPropertyChange,this),o.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=R,this.reset(),R.md(this.handleDataPropertyChange,this),R.mm(this.handleDataModelChange,this),this.fp("dataModel",o,R))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(b){"alarmState"===b.property&&(this.increase(b.data),this.fireAlarmStateChange())},handleDataModelChange:function(N){"add"===N.kind?(this.increase(N.data),this.fireAlarmStateChange()):"remove"===N.kind?(this.decrease(N.data),this.fireAlarmStateChange()):"clear"===N.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,m.each(function(x){var $=this.getSumInfo(x);this.sumAcked+=$.ackedCount,this.sumNew+=$.newCount,this.sumTotal+=$.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(b){if(!b)return this.sumNew;var o=this.getSumInfo(b);return o.newCount},getAcknowledgedAlarmCount:function(Z){if(!Z)return this.sumAcked;var K=this.getSumInfo(Z);return K.ackedCount},getTotalAlarmCount:function(X){if(!X)return this.sumTotal;var B=this.getSumInfo(X);return B.totalCount},getSumInfo:function(A){var q=this.severtiyMap[A.name];return q||(q={},q.newCount=0,q.ackedCount=0,q.totalCount=0,this.severtiyMap[A.name]=q),q},decrease:function(P){var C=this.dataMap[P.getId()];C&&(delete this.dataMap[P.getId()],m.each(function(D){var W=C[D.name],n=this.getSumInfo(D);n.newCount=n.newCount-W.newCount,n.ackedCount=n.ackedCount-W.ackedCount,n.totalCount=n.totalCount-W.totalCount},this))},increase:function(B){if(this.decrease(B),!this._filterFunc||this._filterFunc(B)){var I={},l=B.getAlarmState();this.dataMap[B.getId()]=I,m.each(function(T){var X={};X.newCount=l.getNewAlarmCount(T),X.ackedCount=l.getAcknowledgedAlarmCount(T),X.totalCount=l.getAlarmCount(T),I[T.name]=X;var O=this.getSumInfo(T);O.newCount=O.newCount+X.newCount,O.ackedCount=O.ackedCount+X.ackedCount,O.totalCount=O.totalCount+X.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(W){var t=this._filterFunc;this._filterFunc=W,this.reset(),this.firePropertyChange("filterFunc",t,W)},getFilterFunc:function(){return this._filterFunc}});var f=ht.Data.prototype;f.getAlarmState=function(){return this._alarmState||(this._alarmState=new G(this))},f=ht.DataModel.prototype,f.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},f.setEnableAlarmStatePropagator=function(v){v!=this.isEnableAlarmStatePropagator()&&(v?(this._alarmStatePropagator=new e(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},f=ht.graph.GraphView.prototype,f.getNote2=function(K){var u=K.getAlarmState().getHighestNewAlarmSeverity();if(u){var n=K.getAlarmState().getNewAlarmCount(u)+u.nickName;return K.getAlarmState().hasLessSevereNewAlarms()&&(n+="+"),n}return K.s("note2")},f.getNote2Background=function(Z){var H=Z.getAlarmState().getHighestNewAlarmSeverity();return H?H.color:Z.s("note2.background")},f.getBodyColor=function(A){var l=A.getAlarmState().getHighestNativeAlarmSeverity();return l?l.color:A.s("body.color")},f.getBorderColor=function($){var w=$.getAlarmState().getPropagateSeverity();return w?w.color:$.s("border.color")},f=ht.widget.TreeView.prototype,f.getBorderColor=function(J){var D=J.getAlarmState().getPropagateSeverity();return D?D.color:J.s("border.color")},f.getIcon=function(b){return b.getIcon()?"__alarmIcon__":null},f=ht.widget.TreeTableView.prototype,f.getBorderColor=function(k){var J=k.getAlarmState().getPropagateSeverity();return J?J.color:k.s("border.color")},f.getIcon=function(D){return D.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(_){return _.getIcon()}},color:{func:function(E){var K=E.getAlarmState().getHighestNativeAlarmSeverity();return K?K.color:E.s("body.color")}},rect:[0,0,16,16]}]});var Z=ht.Style;Z["note2.expanded"]=!0,Z["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);