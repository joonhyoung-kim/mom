!function(K){"use strict";var _="ht",B=K[_],M=B.Default,P=Math,H=P.PI,W=2*H,f=P.sin,w=P.cos,Z=P.atan2,I=P.sqrt,c=P.max,g=P.floor,j=(P.round,P.ceil),q=P.abs,b=B.Shape,s=B.Edge,n=B.List,U=B.Style,k=B.graph,F=M.getInternal(),p=F.ui(),e=null,R="__segmentLengths",o="__lineTotalLength",S="__linePoints",r="__distance0",O="flow.count",V="flow.step",N="flow.element.max",C="flow.element.count",L="flow.element.min",A="flow.element.space",T="flow.element.autorotate",X="flow.element.background",l="flow.element.shadow.max",v="flow.element.shadow.min",t="flow.element.shadow.begincolor",G="flow.element.shadow.endcolor",y="flow.element.shadow.visible",J="flow.element.image",$="flow",Y="prototype",u=k.GraphView[Y],z=B.Data[Y],i=p.DataUI[Y],x=p.ShapeUI[Y],Q=p.EdgeUI[Y],a=B.DataModel[Y],D=x._80o,h=Q._80o,m=a.prepareRemove,E=Q._79o,d=x._79o,Hb=u.setDataModel,dj=function(I){return document.createElement(I)};u.calculatePointLength=function(E,k,l){var d=this,j=d.getDataUI(E);l==e&&(l=.1);var w=Qf(j),z=[];if(w){for(var G=w.length,O=0;G>O;O++){var h=w[O];h._as&&(h=h._as);for(var g=h[0],p=1;p<h.length;p++)z.push([g,h[p]]),g=h[p]}for(var f=[],O=0;O<z.length;O++){var x=Jn(z[O][0],z[O][1],k);f.push(x)}var Q=f.slice(0);Q.sort(function(D,m){return D.z>m.z?1:D.z<m.z?-1:0});var X=Q[0];if(X.z<l){for(var I=f.indexOf(X),o=0,O=0;I>=O;O++)o+=I>O?M.getDistance(z[O][0],z[O][1]):M.getDistance(z[O][0],X);return o}}},M.calculatePointLength=function(t,m,s,i){i==e&&(i=.1);var E=Qf(e,t,m),m=[];if(E){for(var l=E.length,q=0;l>q;q++){var A=E[q];A._as&&(A=A._as);for(var w=A[0],y=1;y<A.length;y++)m.push([w,A[y]]),w=A[y]}for(var r=[],q=0;q<m.length;q++){var c=Jn(m[q][0],m[q][1],s);r.push(c)}var G=r.slice(0);G.sort(function(y,E){return y.z>E.z?1:y.z<E.z?-1:0});var v=G[0];if(v.z<i){for(var Y=r.indexOf(v),L=0,q=0;Y>=q;q++)L+=Y>q?M.getDistance(m[q][0],m[q][1]):M.getDistance(m[q][0],v);return L}}},u.calculateClosestPoint=function(i,s){var k=this,g=k.getDataUI(i),E=Qf(g),Q=[];if(E){for(var F=E.length,t=0;F>t;t++){var S=E[t];S._as&&(S=S._as);for(var J=S[0],L=1;L<S.length;L++)Q.push([J,S[L]]),J=S[L]}for(var f=[],t=0;t<Q.length;t++){var K=Jn(Q[t][0],Q[t][1],s);f.push(K)}return f.sort(function(k,i){return k.z>i.z?1:k.z<i.z?-1:0}),f[0]}},M.calculateClosestPoint=function(_,t,S){var D=Qf(e,_,t),t=[];if(D){for(var H=D.length,X=0;H>X;X++){var j=D[X];j._as&&(j=j._as);for(var y=j[0],F=1;F<j.length;F++)t.push([y,j[F]]),y=j[F]}for(var h=[],X=0;X<t.length;X++){var n=Jn(t[X][0],t[X][1],S);h.push(n)}return h.sort(function(t,C){return t.z>C.z?1:t.z<C.z?-1:0}),h[0]}},u.getPercentAngle=function(i,P){var h=this,C=h.getDataUI(i),q=i.getRotation?i.getRotation():0,Q=Qf(C);if(Q)if(0===P){var F=Q[0][0],W=Q[0][1];q+=Z(W.y-F.y,W.x-F.x)}else if(100===P){Q=Q[Q.length-1];var F=Q[Q.length-2],W=Q[Q.length-1];q+=Z(W.y-F.y,W.x-F.x)}else{for(var d=0,s=[],E=Q.length,$=0;E>$;$++){var B=Q[$],t=xe(B);d+=t,s.push(t)}for(var w=d*P/100,J=zr(w,s),_=0,l=0;J>l;l++)_+=s[l];w-=_;for(var o=Xg(Q[J],w),L=Q[J],y=0,V=0,e=0;e<L.length-1;e++){var j=L[e],v=L[e+1],O=v.x-j.x,x=v.y-j.y,n=I(O*O+x*x);if(y+=n,y>w){V=e;break}}var T=L[V];q+=Z(o.y-T.y,o.x-T.x)}return q},M.getPercentAngle=function(X,S,u){var E=0,Y=Qf(e,X,S);if(Y)if(0===u){var k=Y[0][0],v=Y[0][1];E+=Z(v.y-k.y,v.x-k.x)}else if(100===u){Y=Y[Y.length-1];var k=Y[Y.length-2],v=Y[Y.length-1];E+=Z(v.y-k.y,v.x-k.x)}else{for(var g=0,D=[],s=Y.length,P=0;s>P;P++){var f=Y[P],n=xe(f);g+=n,D.push(n)}for(var R=g*u/100,L=zr(R,D),x=0,$=0;L>$;$++)x+=D[$];R-=x;for(var z=Xg(Y[L],R),Q=Y[L],T=0,p=0,W=0;W<Q.length-1;W++){var c=Q[W],y=Q[W+1],F=y.x-c.x,q=y.y-c.y,i=I(F*F+q*q);if(T+=i,T>R){p=W;break}}var J=Q[p];E+=Z(z.y-J.y,z.x-J.x)}return E},u.calculateLength=function(H){var q=this,w=q.getDataUI(H),F=Qf(w),$=0;if(F)if(Array.isArray(F[0]))for(var I=F.length,f=0;I>f;f++){var o=F[f],Z=xe(o);$+=Z}else $=xe(F);return $},M.calculateLength=function(m,Q){var m=Qf(e,m,Q),C=0;if(m)if(Array.isArray(m[0]))for(var v=m.length,$=0;v>$;$++){var S=m[$],l=xe(S);C+=l}else C=xe(m);return C};var Jn=M.calculateClosestPointOnLine=function(U,L,y){var $=U.x,R=U.y,T=L.x,f=L.y,k=y.x,Y=y.y,v={},O=T-$,h=f-R,M=Math.sqrt(O*O+h*h),J=O/M,p=h/M,c=(-$+k)*J+(-R+Y)*p;return v.x=$+c*J,v.y=R+c*p,Bm(v,U,L)||(v.x=Math.abs(v.x-U.x)<Math.abs(v.x-L.x)?U.x:L.x,v.y=Math.abs(v.y-U.y)<Math.abs(v.y-L.y)?U.y:L.y),O=k-v.x,h=Y-v.y,v.z=Math.sqrt(O*O+h*h),v},Bm=function(k,L,b){return k.x>=Math.min(L.x,b.x)&&k.x<=Math.max(L.x,b.x)&&k.y>=Math.min(L.y,b.y)&&k.y<=Math.max(L.y,b.y)},xe=function(m){for(var h=0,J=m.length-1,Q=0;J>Q;Q++){var F=m[Q],S=m[Q+1],P=S.x-F.x,u=S.y-F.y,X=I(P*P+u*u);h+=X}return h},Xg=function(O,U){for(var c=0,A=0,V=0,e=O.length-1,D=0;e>D;D++){var Q=O[D],H=O[D+1],_=H.x-Q.x,z=H.y-Q.y;if(V=I(_*_+z*z),c+=V,c>U){c-=V,A=D;break}}var F=O[A],M=O[A+1],T=Z(M.y-F.y,M.x-F.x),l=U-c,z=f(T)*l,_=w(T)*l;return{x:F.x+_,y:F.y+z}},_j=function(A,O,t,K){var u=w(K),P=f(K),b=u*O-P*t,c=P*O+u*t;return A?{x:A.x+b,y:A.y+c}:{x:b,y:c}},pe=function(Q,q){Q[R]=Q[o]=Q[S]=q[r]=e},Bb=function(c,i,a,G,Z,O){var V,U,t,x,Q,K,k,h,N,_,I,e=[];if(q(G)>W&&(G=W),Q=j(q(G)/(H/4)),V=G/Q,U=-V,t=-a,Q>0){K=c+w(a)*Z,k=i+f(-a)*O,e.push({x:K,y:k});for(var d=0;Q>d;d++)t+=U,x=t-U/2,h=c+w(t)*Z,N=i+f(t)*O,_=c+w(x)*(Z/w(U/2)),I=i+f(x)*(O/w(U/2)),e.push({x:_,y:I}),e.push({x:h,y:N})}return e},Qf=function(Z,H,T){if(H==e){var V=Z._data;if(V instanceof b){if(H=V.getPoints(),T=V.getSegments(),(!T||0===T.size())&&H){T=new B.List([1]);for(var D=1;D<H.size();D++)T.add(2)}}else if(V instanceof s){var G=Z._78o;if(G){var d=G.type,h=G.points,E=G.segments,m=G._4O;if(!d||h){var O=G.sourcePoint,Q=O.x,z=O.y,t=G.targetPoint,c=t.x,R=t.y;if(d)E?(H=new n({x:Q,y:z}),H.addAll(h),H.add({x:c,y:R}),T=new n(E._as)):(H=new n({x:Q,y:z}),T=new n([1]),h.each(function(B){H.add(B),T.add(2)}),H.add({x:c,y:R}),T.add(2));else if(G.looped){H=new n(Bb(Q,z,0,W,G.radius,G.radius)),T=new n([1]);for(var D=0;D<(H.size()-1)/2;D++)T.add(3)}else H=new n,G.center?(H.add({x:G.c1.x,y:G.c1.y}),H.add({x:Q,y:z}),H.add({x:c,y:R}),H.add({x:G.c2.x,y:G.c2.y}),T=new n([1,2,2,2])):(H.add({x:Q,y:z}),H.add({x:c,y:R}),T=new n([1,2]))}else if(m)if(H=new n(m.points._as),m.segments)T=new n(m.segments._as);else{T=new n([1]);for(var D=1;D<m.points.size();D++)T.add(2)}}}}if(H){if(Array.isArray(H)&&(H=new n(H)),"number"==typeof H.get(0)){for(var k=new B.List,D=0;D<H.size();D+=2)k.add({x:H.get(D),y:H.get(D+1)});H=k}if(!T){T=[];for(var D=0;D<H.size();D++)0===D?T.push(1):T.push(2)}Array.isArray(T)&&(T=new n(T));for(var A=F.toPointsArray(H._as,T._as,50),M=A.length,K=[],D=0;M>D;D++){var I=A[D];I.length>1&&K.push(I)}return K}},Im=function(q){var C=q._data,F=Qf(q);if(F){C.s("flow.reverse")&&(F.reverse(),F.forEach(function(O){O.reverse()}));for(var f=0,H=[],$=F.length,h=0;$>h;h++){var c=F[h],t=xe(c);f+=t,H.push(t)}if(C[R]=H,C[o]=f,C[S]=F,C instanceof s){var i=M.unionPoint(F),J=i.x+i.width/2,Q=i.y+i.height/2;C.$10e={x:J,y:Q}}go(q,!0)}},go=(M.getPercentPositionOnPoints=function(y,$,D){if(y){var m=Qf(e,y,$);if(m){var r;if(0===D)r=m[0][0];else if(100===D)m=m[m.length-1],r=m[m.length-1];else{for(var n=0,o=[],x=m.length,v=0;x>v;v++){var d=m[v],I=xe(d);n+=I,o.push(I)}for(var G=n*D/100,z=zr(G,o),X=0,Y=0;z>Y;Y++)X+=o[Y];G-=X,r=Xg(m[z],G)}return r}}},u.getPercentPosition=function(t,r){var e=this,$=e.getDataUI(t),x=Qf($);if(x){var c;if(0===r)c=x[0][0];else if(100===r)x=x[x.length-1],c=x[x.length-1];else{for(var s=0,Z=[],S=x.length,D=0;S>D;D++){var q=x[D],X=xe(q);s+=X,Z.push(X)}for(var b=s*r/100,F=zr(b,Z),M=0,Q=0;F>Q;Q++)M+=Z[Q];b-=M,c=Xg(x[F],b)}return c}},function(f,T){var $=f._data,I=$[o],s=$.s(O),K=$.s(V),d=0,w=$[R],z=$.s(N),_=$.s(L),D=$.s(C),X=(z-_)/(D-1),M=[];if(w){if(1===D)M.push(z);else if(2===D)M.push(z),M.push(_);else{if(!(D>2))return;M.push(z);for(var y=D-2;y>0;y--)M.push(_+X*y);M.push(_)}var H=0,W=0;M.forEach(function(O){D-1>H&&(W+=$.getFlowElementSpace(O)),H++}),W+=(z+_)/2,d=(I-s*W+W)/s;var J=f[r];for(null==J&&(J=0),T||(J+=K);J>I+W;){var Z=f._overCount;Z?Z++:Z=1,Z>=s&&(Z=null),f._overCount=Z,$.s("flow.autoreverse")?Z?J-=d+W:(J=0,$.s("flow.reverse",!$.s("flow.reverse"))):J-=d+W}f[r]=J}}),Nk=function(F){var U=F.data,B=this.dm();if(U&&"add"===F.kind){var K=B.$3e;K&&U.s($)&&K.indexOf(U)<0&&K.push(U)}"clear"===F.kind&&(B.$3e=[])},fp=function(A){var u=A.property,i=A.data,e=A.newValue,J=this.dm().$3e;if(J&&"s:flow"===u)if(e)J.indexOf(i)<0&&J.push(i);else for(var C=J.length,k=0;C>k;k++)if(J[k]===i){J.splice(k,1);break}},zr=zr=function(B,l){for(var F=0,h=l.length,Z=0;h>Z;Z++){var A=l[Z];if(F+=A,F>B)return Z}return Math.min(Z,h-1)},an=function(A){var Q=this,q=Q._data,V=q[o],m=q[R],X=q[S],B=q.s(O),W=0,Y=Q[r],b=q.s(N),n=q.s(L),t=q.s(C),p=q.s(v),F=q.s(l),P=q.s(T),a=(F-p)/(t-1),u=(b-n)/(t-1),g=q.getRotation?q.getRotation():0,x=q.getPosition?q.p():q.$10e,J=[],D=[];if(Y!=e){if(1===t)J.push(b);else if(2===t)J.push(b),J.push(n);else{if(!(t>2))return;J.push(b);for(var E=t-2;E>0;E--)J.push(n+u*E);J.push(n)}if(1===t)D.push(F);else if(2===t)D.push(F),D.push(p);else{if(!(t>2))return;D.push(F);for(var E=t-2;E>0;E--)D.push(p+a*E);D.push(p)}var M=0,d=0;J.forEach(function(V){t-1>M&&(d+=q.getFlowElementSpace(V)),M++}),d+=(b+n)/2,W=(V-B*d+d)/B,A.save();for(var E=0;B>E;E++){var K=Y,h=0,s=Q._overCount,U=0;q.s("flow.autoreverse")&&s&&s>B-(E+1)||(K-=E*(W+d),M=0,J.forEach(function(R){var b=K-h;if(b>=0&&V>b){var l=!0,e=zr(b,m);U=0;for(var E=0;e>E;E++)U+=m[E];if(b-=U,l){var k=Xg(X[e],b),C=g;if(P){for(var p=X[e],t=0,c=0,z=0;z<p.length-1;z++){var Y=p[z],i=p[z+1],G=i.x-Y.x,o=i.y-Y.y,$=I(G*G+o*o);if(t+=$,t>b){c=z;break}}var a=p[c];C+=Z(k.y-a.y,k.x-a.x)}g&&(k=_j(x,k.x-x.x,k.y-x.y,g)),Q.$5e(A,k,R,D[M],C)}}h+=q.getFlowElementSpace(J[M]),M++}))}A.restore()}},ur=function(){var Y=this,f=Y._data,x=f.s(N),g=!1,t=e;if(Y._6I||(g=!0),t=f instanceof s?E.call(Y):d.call(Y),f.s($)&&g){var m=f.s(l),A=f.s(y);A&&m>x&&(x=m),x>0&&M.grow(t,j(x/2)),Im(Y)}return!f.s($)&&g&&pe(f,Y),t};z.getFlowElementSpace=function(){return this.s(A)},x._79o=ur,Q._79o=ur,U[N]==e&&(U[N]=7),U[L]==e&&(U[L]=0),U[O]==e&&(U[O]=1),U[V]==e&&(U[V]=3),U[C]==e&&(U[C]=10),U[A]==e&&(U[A]=3.5),U[T]==e&&(U[T]=!1),U[X]==e&&(U[X]="rgba(255, 255, 114, 0.4)"),U[t]==e&&(U[t]="rgba(255, 255, 0, 0.3)"),U[G]==e&&(U[G]="rgba(255, 255, 0, 0)"),U[y]==e&&(U[y]=1),U[l]==e&&(U[l]=22),U[v]==e&&(U[v]=4),a.prepareRemove=function(e){m.call(this,e);var Q=e._dataModel,i=Q.$3e;if(i)for(var O=i.length,I=0;O>I;I++)if(i[I]===e){i.splice(I,1);break}},u.setDataModel=function(C){var t=this,h=t._dataModel;if(h!==C){h&&(h.umm(Nk,t),h.umd(fp,t),h.$3e=[]),C.mm(Nk,t),C.md(fp,t);var H=C.$3e=[];C.each(function(A){A.s($)&&H.indexOf(A)<0&&H.push(A)}),Hb.call(t,C)}},u.setFlowInterval=function(C){var f=this,w=f.$11e;f.$11e=C,f.fp("flowInterval",w,C),f.$7e!=e&&(clearInterval(f.$7e),delete f.$7e,f.enableFlow(C))},u.getFlowInterval=function(){return this.$11e},u.$9e=function(){var z,J,v,Z=this,R=Z.tx(),I=Z.ty(),V=Z.getZoom(),k=Z.getWidth(),t=Z.getHeight(),O={x:-R/V,y:-I/V,width:k/V,height:t/V},H=Z.dm().$3e,x=Z._56I,A=new n;if(H.forEach(function(C){x[C.getId()]&&(z=Z.getDataUI(C),z&&(v=z._79o(),v&&A.add(v)))}),0!==A.size()&&(A.each(function(d){M.intersectsRect(O,d)&&(J=M.unionRect(J,d))}),J&&(J&&(M.grow(J,c(1,1/V)),J.x=g(J.x*V)/V,J.y=g(J.y*V)/V,J.width=j(J.width*V)/V,J.height=j(J.height*V)/V,J=M.intersection(O,J)),J))){var o=Z._canvas.getContext("2d");o.save(),o.lineCap=M.lineCap,o.lineJoin=M.lineJoin,F.translateAndScale(o,R,I,V),o.beginPath(),o.rect(J.x,J.y,J.width,J.height),o.clip(),o.clearRect(J.x,J.y,J.width,J.height),Z.$6e(o,J),o.restore()}},u.$6e=function(B,H){var v,a,y=this;y._93db(B),y.each(function(f){y._56I[f._id]&&(v=y.getDataUI(f),v&&(a=v._79o(),(!H||M.intersectsRect(H,a))&&v._42(B)))}),y._92db(B)},u.enableFlow=function(h){var d=this,Q=d.dm(),O=Q.$3e;d.$7e==e&&(O.forEach(function(c){var v=d.getDataUI(c);Im(v)}),d.$7e=setInterval(function(){Q.$3e.forEach(function(b){go(d.getDataUI(b))}),d.$9e()},h||d.$11e||50))},u.disableFlow=function(){var G=this;clearInterval(G.$7e),delete G.$7e;var y=G.dm().$3e;y&&G.$9e()},i.$5e=function(H,C,q,R,a){var f=this,x=f._data,Z=f.gv,Q=x.s(X),k=x.s(t),P=x.s(G),K=x.s(y),l=Z.$8e,n=x.s(J);if(l==e&&(l=Z.$8e={}),H.beginPath(),n!=e){var m=M.getImage(n),T=q/2;H.translate(C.x,C.y),H.rotate(a),H.translate(-C.x,-C.y),M.drawImage(H,m,C.x-T,C.y-T,q,q,x),H.translate(C.x,C.y),H.rotate(-a),H.translate(-C.x,-C.y)}else H.fillStyle=Q,H.arc(C.x,C.y,q/2,0,W,!0),H.fill();if(K){var h=22,B=h+"_"+k+"_"+P,O=l[B];if(O==e){var s=dj("canvas");F.setCanvas(s,h,h);var _=s.getContext("2d"),u=h/2,p=u,i=u;F.translateAndScale(_,0,0,1),_.beginPath();var U=_.createRadialGradient(p,i,0,p,p,u);U.addColorStop(0,k),U.addColorStop(1,P),_.fillStyle=U,_.arc(p,i,u,0,W,!0),_.fill(),O=l[B]=s}var T=R/2;M.drawImage(H,O,C.x-T,C.y-T,R,R,x)}},Q._80o=function(O){h.call(this,O);var G=this,U=G._data,w=G.gv;U.s($)&&w.$7e!=e&&an.call(G,O)},x._80o=function(h){D.call(this,h);var o=this,s=o._data,d=o.gv;s.s($)&&d.$7e!=e&&an.call(o,h)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);