!function(o,b){"use strict";var s="ht",J=o[s],F=J.Default,h=F.def,T="add",A="remove",I=F.getInternal(),H="propertyChange";J.HistoryManager=function(n){this._histories=[],this.setDataModel(n)},h(J.HistoryManager,b,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var Y=this;Y.$4p++,1===Y.$4p&&(Y.$3p=[])},endInteraction:function(){var Z=this,G=Z._histories,H=Z._historyIndex,l=Z.$3p;Z.$4p>0&&Z.$4p--,0===Z.$4p&&(delete Z.$3p,l&&l.length&&(G=G.slice(0,H+1),G.push(l),G.length>Z._maxHistoryCount&&(G=G.slice(G.length-Z._maxHistoryCount)),Z.setHistories(G),Z.setHistoryIndex(G.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(A){var m=this,R=m._dataModel;R!==A&&(R&&(delete R._historyManager,R.umm(m.$5p,m),R.umd(m.$6p,m)),m._dataModel=A,A._historyManager=m,A.mm(m.$5p,m),A.md(m.$6p,m),m.fp("dataModel",R,A),m.clear())},setHistoryIndex:function(G,P){var J=this,K=J._historyIndex,Y=J._histories.length;if(-1>G?G=-1:G>=Y&&(G=Y-1),K!==G){if(!P){var t=G-K;t>0?J.$2p(t):0>t&&J.$1p(-t)}J._historyIndex=G,J.fp("historyIndex",K,G)}},setMaxHistoryCount:function(e){var l=this,O=l._histories,W=l._maxHistoryCount;(!e||0>=e)&&(e=10),W!==e&&(l._maxHistoryCount=e,l.fp("maxHistoryCount",W,e),O.length>e&&l.clear())},isPropertyRecode:function(){return!0},$5p:function(u){if(!this.$7p&&!this.$8p){var P,k,I=this,F=I._histories,C=u.kind,J=u.property,b=I._historyIndex;if(C===T||C===A?k={type:u.kind,data:u.data}:I.isPropertyRecode(J)&&J&&"children"!==J&&"attaches"!==J&&"shape"!==J&&"*"!==J&&(k={type:H,data:u.data,property:J,oldValue:u.oldValue,newValue:u.newValue}),k)if(I.$4p){P=I.$3p;var l=!1;if(k.type===H)for(var w=P.length-1;w>=0;w--){var n=P[w];if(n.type!==H)break;k.property===n.property&&n.property&&k.data===n.data&&(k.oldValue=n.oldValue,P[w]=k,l=!0)}l||P.push(k)}else P=[k],F=F.slice(0,b+1),F.push(P),F.length>I._maxHistoryCount&&(F=F.slice(F.length-I._maxHistoryCount)),I.setHistories(F),I.setHistoryIndex(F.length-1,!0)}},$6p:function(g){this.$5p(g)},undo:function(V){(!V||0>=V)&&(V=1),this.setHistoryIndex(this._historyIndex-V)},$1p:function(n){var K,v=this,M=v._dataModel,H=v._histories,p=v._historyIndex;for(v.$7p=1,F.setIsolating(!0);n>0;){if(p>=0&&p<H.length){K=H[p],p--;for(var f=K.length-1;f>=0;f--){var x=K[f],r=x.type,X=x.data,k=x.property,U=x.oldValue;if(r===T)M.remove(X);else if(r===A)M.add(X);else{var $=null;0===k.indexOf("a:")?($="attr",k=k.replace("a:","")):0===k.indexOf("s:")&&($="style",k=k.replace("s:","")),I.setPropertyValue(X,$,k,U)}}}n--}F.setIsolating(!1),delete v.$7p},redo:function(V){(!V||0>=V)&&(V=1),this.setHistoryIndex(this._historyIndex+V)},$2p:function(q){var g,V=this,c=V._dataModel,N=V._histories,W=V._historyIndex;for(V.$7p=1,F.setIsolating(!0);q>0;){if(W>=-1&&W<N.length-1){W++,g=N[W];for(var D=0;D<g.length;D++){var w=g[D],o=w.type,s=w.data,z=w.property,Z=w.newValue;if(o===T)c.add(s);else if(o===A)c.remove(s);else{var S=null;0===z.indexOf("a:")?(S="attr",z=z.replace("a:","")):0===z.indexOf("s:")&&(S="style",z=z.replace("s:","")),I.setPropertyValue(s,S,z,Z)}}}q--}F.setIsolating(!1),delete V.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);