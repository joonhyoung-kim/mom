!function(r,P){"use strict";var t="ht",I=r[t],o=I.Default,B=o.getInternal();B.addMethod(o,{svgToShape:function(y,z){var l=new I.SvgConverter(z);return{converer:l,output:l.toShape(y)}}});var M=I.Context2dProxy=function(C,j){var H=this;H.ctx=C,H.writer=j,H.$1A={a:1,b:0,c:0,d:1,tx:0,ty:0},H.$2A(),H.$3A=!0,H.$4A=16,H.$5A=[];for(var D in CanvasRenderingContext2D.prototype)if("webkitImageSmoothingEnabled"!==D){var O=C[D];if("function"==typeof O)H[D]=function(v,x){return function(){var s=x.apply(C,arguments);return H.handleFunc(v,s,arguments),s}}(D,O);else{var p=P.getOwnPropertyDescriptor(CanvasRenderingContext2D.prototype,D);if(!p.get&&!p.set)continue;!function(x){P.defineProperty(H,x,{get:function(){return C[x]},set:function(B){C[x]=B,H.handleSetter(x,B)}})}(D)}}};M.prototype={},M.prototype.constructor=M,M.prototype.handleFunc=function(y,I,t){var m=this;switch(y){case"save":m.$7A();break;case"restore":m.$8A();break;case"translate":m.$9A.apply(m,t);break;case"rotate":m.$AA.apply(m,t);break;case"scale":m.$BA.apply(m,t);break;case"setTransform":m.$CA.apply(m,t);break;case"transform":m.$DA.apply(m,t);break;case"fillText":case"strokeText":m.$EA(t[0],t[1],t[2],"fillText"===y);break;case"rect":m.$FA.apply(m,t);break;case"fill":m._ctxFill(t[0]);break;case"stroke":m.$10A(!0);break;case"moveTo":m.$11A(t[0],t[1]);break;case"lineTo":m.$12A(t[0],t[1]);break;case"beginPath":m.$13A();break;case"closePath":m.$14A();break;case"arc":m.$15A.apply(m,t);break;case"ellipse":m.$16A.apply(m,t);break;case"quadraticCurveTo":m.$17A([{x:t[0],y:t[1]}],t[2],t[3]);break;case"bezierCurveTo":m.$17A([{x:t[0],y:t[1]},{x:t[2],y:t[3]}],t[4],t[5]);break;case"createLinearGradient":I.points=t}},M.prototype.handleSetter=function(){},M.prototype.$7A=function(){var z=this,I={},b=z.$1A;for(var U in b)I[U]=b[U];z.$5A.push(I)},M.prototype.$8A=function(){var r=this;r.$1A=r.$5A.pop(),r._transformUpdated()},M.prototype.$9A=function(i,M){if(0!==i||0!==M){var L=this,x=L.$1A,I=x.a,w=x.b,G=x.c,f=x.d;x.tx=I*i+G*M+x.tx,x.ty=w*i+f*M+x.ty,L._transformUpdated()}},M.prototype.$BA=function(B,$){if(1!==B||1!==$){var T=this,O=T.$1A;O.a*=B,O.b*=B,O.c*=$,O.d*=$,T._transformUpdated()}},M.prototype.$AA=function(U){var N=Math.cos(U),o=Math.sin(U),_=this,z=_.$1A,t=z.a,F=z.b,i=z.c,d=z.d;z.a=t*N+i*o,z.b=F*N+d*o,z.c=-t*o+i*N,z.d=-F*o+d*N,_._transformUpdated()},M.prototype.$CA=function(a,i,z,F,y,R){var s=this,W=s.$1A;W.a=a,W.b=i,W.c=z,W.d=F,W.tx=y,W.ty=R,s._transformUpdated()},M.prototype.$DA=function(H,r,C,W,V,G){var q=this,i=q.$1A,v=i.a,t=i.b,Y=i.c,Q=i.d;i.a=v*H+Y*r,i.b=t*H+Q*r,i.c=v*C+Y*W,i.d=t*C+Q*W,i.tx=v*V+Y*G+i.tx,i.ty=t*V+Q*G+i.ty,q._transformUpdated()},M.prototype._transformUpdated=function(){},M.prototype.$18A=function(){var w=this.$1A;return 0===w.b&&0===w.c?0:Math.atan2(w.b,w.a)},M.prototype.$19A=function(){var R=this.$1A;return{x:Math.sqrt(R.a*R.a+R.c*R.c),y:Math.sqrt(R.b*R.b+R.d*R.d)}},M.prototype.$20A=function(e){var t=this.$1A,c=e.x,Z=e.y;return{x:t.a*c+t.c*Z+t.tx,y:t.b*c+t.d*Z+t.ty}},M.prototype.$21A=function(V){for(var m=this,Y=new Array(V.length),B=0,l=V.length;l>B;B++)Y[B]=m.$20A(V[B]);return Y},M.prototype.$22A=function(e){var A=this.$1A;return e*Math.max(Math.sqrt(A.c*A.c+A.d*A.d),Math.sqrt(A.a*A.a+A.b*A.b))},M.prototype.$23A=function(k,A){var X=k-A;return X>-1e-5&&1e-5>X},M.prototype.$EA=function(l,s,j,e){var w,n,W=this,Y=W.ctx,g=Y.font,B=e?Y.fillStyle:Y.strokeStyle,M=Y.textAlign,I=Y.textBaseline;"string"==typeof g&&(n=g.match(/\d+/),n&&(w=n[0],g=g.replace(/\d+/,W.$22A(w))));var Q=W.$18A();"alphabetic"===I?(I="bottom",j+=.25*Y.measureText("e").width):"hanging"===I&&(I="top",j+=.2*Y.measureText("e").width),W.writer.$2AA(l,W.$20A({x:s,y:j}),g,Q,M,I,B)},M.prototype.$FA=function(V,m,b,o){var $=this,S=$.$21A([{x:V,y:m},{x:V+b,y:m},{x:V+b,y:m+o},{x:V,y:m+o}]);$._path.push({type:"rect",points:S})},M.prototype.$11A=function(X,V){var q=this,F=q.$20A({x:X,y:V});q._headPoint=F,q._path.push({type:"moveTo",x:F.x,y:F.y})},M.prototype.$12A=function(q,A){var j=this,G=j.$20A({x:q,y:A});j._path.push({type:"lineTo",x:G.x,y:G.y})},M.prototype.$15A=function(L,K,w,e,V,E){this.$16A(L,K,w,w,0,e,V,E)},M.prototype.$16A=function($,O,A,v,_,E,T,u){var D,B,G,U,e,w,o,S,Y,C,F,y,q,d,Q,K=this,g=K.$19A(),r=K.$20A({x:$,y:O});w=Math.sin(_),o=Math.cos(_);var x=function(c){var C=A*Math.cos(-c),n=v*Math.sin(-c);return K.$20A({x:$+(o*C-w*n),y:O+(w*C+o*n)})},W=[],c=T;if(u)for(;c>=E;)c-=2*Math.PI;else for(;E>=c;)c+=2*Math.PI;for(C=(c-E)/K.$4A,y=0;y<=K.$4A;y++)F=E+C*y,q=x(-F),W.push(q);if(U=W[0],e=W[W.length-1],D=K.$24A(E,T,u),E=D.start,T=D.end,S=K.$23A(g.x,g.y),Y=K.$23A(A,v),!K.$3A&&S&&Y&&K.$23A(Math.abs(E-T),2*Math.PI))K._path.push({type:"circle",x:r.x,y:r.y,end:e,keyPoints:W,radius:A*g.x});else if(!K.$3A&&S&&Y)B=K.$18A(),G=Math.cos(B),d=K.$1A.a*G<0,Q=K.$1A.d*G<0,D=K.$25A(E,T,d,Q),E=D.start-B,T=D.end-B,K._path.push({type:"arc",x:r.x,y:r.y,end:e,radius:A*g.x,startAngle:E,endAngle:T,keyPoints:W});else{if(K.$3A||!S){for(y=1;y<=K.$4A;y++)q=W[y],K._path.push({type:"lineTo",x:q.x,y:q.y});return}var P,J,H=x(0),R=x(Math.PI/2),V=function(Z,E){var M=Z.x-E.x,J=Z.y-E.y;return Math.sqrt(M*M+J*J)},m=V(H,r),a=V(R,r);a>m?(J=m,m=a,a=J,P=R):P=H,B=K.$18A(),G=Math.cos(B),d=K.$1A.a*G<0,Q=K.$1A.d*G<0,D=K.$25A(E-Math.PI/2,T-Math.PI/2,d,Q),E=D.start,T=D.end,K._path.push({type:"ellipse",x:r.x,y:r.y,end:e,major:{x:P.x-r.x,y:P.y-r.y},ratio:a/m,startAngle:E,endAngle:T,keyPoints:W})}},M.prototype.$17A=function(z,F,E){var f=this,P=f.$20A({x:F,y:E});this._path.push({type:"bezier",x:P.x,y:P.y,ctrl:f.$21A(z)})},M.prototype.$13A=function(){this.$2A()},M.prototype.$14A=function(){var c=this,I=c._headPoint;I&&(c._path.push({type:"lineTo",x:I.x,y:I.y,subType:"closePath"}),c._headPoint=null,c._lastPoint=null)},M.prototype.$24A=function(B,S,E){B=-B,S=-S;var m,h=B%(2*Math.PI),c=S%(2*Math.PI);for(0>h&&(h+=2*Math.PI),0>c&&(c+=2*Math.PI),E||(m=h,h=c,c=m);h>=c;)c+=2*Math.PI;return{start:h,end:c}},M.prototype.$25A=function(t,x,u,g){var m;return(g||u)&&(u&&g?(t=Math.PI+t,x=Math.PI+x):(m=Math.PI*(u?1:2)-x,x=Math.PI*(u?1:2)-t,t=m)),{start:t,end:x}},M.prototype._ctxFill=function(Y){var R=this;return R._fillRule=Y||"nonzero",R.$10A(!1)},M.prototype.$10A=function(L){var n=this,V=n._path;if(V.length){var S,p,u,X,e,J=[],Q=[],y={stroke:L};for(L?(y.lineWidth=n.$22A(n.ctx.lineWidth),y.color=n.ctx.strokeStyle):(y.color=n.ctx.fillStyle,"nonzero"!==n._fillRule&&(y.fillRule=n._fillRule)),"string"!=typeof y.color&&(y.color="#ff0000"),p=0,S=V.length;S>p;p++)switch(u=V[p],u.type){case"moveTo":n._lastPoint={x:u.x,y:u.y},J.push(n._lastPoint),Q.push(1);break;case"lineTo":J.push({x:u.x,y:u.y}),Q.push(2),n._lastPoint={x:u.x,y:u.y};break;case"rect":e=u.points,J.push({x:e[0].x,y:e[0].y},{x:e[1].x,y:e[1].y},{x:e[2].x,y:e[2].y},{x:e[3].x,y:e[3].y},{x:e[0].x,y:e[0].y}),Q.push(2,2,2,2,2),n._lastPoint=u.points[0];break;case"circle":case"arc":case"ellipse":console.log("split to line",u.type);break;case"arcBegin":J.length&&Q.length&&n.writer.$2BA(J,Q,y),J=[],Q=[];break;case"arcClose":n.writer.$2BA(J,Q,y),J=[],Q=[];break;case"bezier":if(X=n._lastPoint,!X)break;1===u.ctrl.length?(J.push({x:u.ctrl[0].x,y:u.ctrl[0].y},{x:u.x,y:u.y}),Q.push(3)):(J.push({x:u.ctrl[0].x,y:u.ctrl[0].y},{x:u.ctrl[1].x,y:u.ctrl[1].y},{x:u.x,y:u.y}),Q.push(4)),n._lastPoint={x:u.x,y:u.y};break;default:J.push({x:u.x,y:u.y}),Q.push(2)}n.writer.$2BA(J,Q,y)}},M.prototype.$2A=function(){var d=this;d._path=[],d._lastPoint=null,d._headPoint=null};var J=I.SvgConverter=function(N){var o=this;o.$26A(N||{}),o.$27A()};J.prototype={},J.prototype.constructor=J,J.prototype.$26A=function(p){var w,A=this;w=A.options={},w.size=p.size||512},J.prototype.$27A=function(){var y=this,A=document.createElement("canvas");A.width=A.height=y.options.size,A.style.width=A.style.height=y.options.size,y._canvas=A,y._segments=[]},J.prototype.toShape=function(p){var $=this,i=$._canvas;$._segments=[];var U=i.getContext;return i.getContext=function(s){return function(e){var o=s.apply(this,arguments);return"2d"===e&&(o=$.$28A(o)),o}}(i.getContext),canvg($._canvas,p),i.getContext=U,$.write()},J.prototype.$28A=function(o){var b=this,H=new I.Context2dProxy(o,b);return H},J.prototype.write=function(){var f=this;return f.output={width:f._canvas.width,height:f._canvas.height,comps:f._segments},f.output},J.prototype.$29A=function(I){var J=this;J._segments.push(I)},J.prototype.$2AA=function(l,P,U,s,y,d,T){y=y||"left","start"===y?y="left":"end"===y&&(y="right"),"alphabetic"===d?d="bottom":"hanging"===d&&(d="top");var V=this;V.$29A({type:"text",color:T,text:l,rotation:s,rect:[P.x,P.y,0,0],align:y,vAlign:d,font:U})},J.prototype.$2BA=function(F,f,t){for(var C=this,s=[],e=0,G=F.length;G>e;e++){var w=F[e];s.push(w.x,w.y)}var n={type:"shape",points:s,segments:f};t.stroke?(n.borderColor=t.color,n.borderWidth=t.lineWidth,n.background=null):(n.borderColor=null,n.borderWidth=0,n.background=t.color,t.gradient&&(n.gradient=t.gradient,n.gradientColor=t.gradientColor),t.fillRule&&(n.fillRule=t.fillRule)),C.$29A(n)},function(D){function K(z){this.ok=!1,"#"==z.charAt(0)&&(z=z.substr(1,6)),z=z.replace(/ /g,""),z=z.toLowerCase();var C={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var k in C)z==k&&(z=C[k]);for(var V=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(h){return[parseInt(h[1],16),parseInt(h[2],16),parseInt(h[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(v){return[parseInt(v[1]+v[1],16),parseInt(v[2]+v[2],16),parseInt(v[3]+v[3],16)]}}],B=0;B<V.length;B++){var L=V[B].re,O=V[B].process,o=L.exec(z);if(o){var m=O(o);this.r=m[0],this.g=m[1],this.b=m[2],this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var v=this.r.toString(16),D=this.g.toString(16),V=this.b.toString(16);return 1==v.length&&(v="0"+v),1==D.length&&(D="0"+D),1==V.length&&(V="0"+V),"#"+v+D+V},this.getHelpXML=function(){for(var v=new Array,c=0;c<V.length;c++)for(var f=V[c].example,o=0;o<f.length;o++)v[v.length]=f[o];for(var b in C)v[v.length]=b;var W=document.createElement("ul");W.setAttribute("id","rgbcolor-examples");for(var c=0;c<v.length;c++)try{var m=document.createElement("li"),g=new K(v[c]),z=document.createElement("div");z.style.cssText="margin: 3px; border: 1px solid black; background:"+g.toHex()+"; "+"color:"+g.toHex(),z.appendChild(document.createTextNode("test"));var k=document.createTextNode(" "+v[c]+" -> "+g.toRGB()+" -> "+g.toHex());m.appendChild(z),m.appendChild(k),W.appendChild(m)}catch(i){}return W}}"undefined"!=typeof define&&define.amd?define(function(){return K}):"undefined"!=typeof module&&module.exports&&(module.exports=K),D.RGBColor=K}("undefined"!=typeof r?r:this),function(M){function D(T){for(var j=T.data,H=4*T.width*T.height,B=0;H>B;B+=4){var a=j[B+3]/255;j[B]*=a,j[B+1]*=a,j[B+2]*=a}}function Z(U){for(var p=U.data,y=4*U.width*U.height,W=0;y>W;W+=4){var v=p[W+3];0!=v&&(v=255/v,p[W]*=v,p[W+1]*=v,p[W+2]*=v)}}function $(c,i,b,A){var T=document.getElementById(c),s=T.naturalWidth,x=T.naturalHeight,S=document.getElementById(i);S.style.width=s+"px",S.style.height=x+"px",S.width=s,S.height=x;var r=S.getContext("2d");r.clearRect(0,0,s,x),r.drawImage(T,0,0),isNaN(b)||1>b||(A?k(i,0,0,s,x,b):v(i,0,0,s,x,b))}function k(t,C,I,B,G,Q){if(!(isNaN(Q)||1>Q)){Q|=0;var h,N=document.getElementById(t),s=N.getContext("2d");try{try{h=s.getImageData(C,I,B,G)}catch(f){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=s.getImageData(C,I,B,G)}catch(f){throw alert("Cannot access local image"),new Error("unable to access local image data: "+f)}}}catch(f){throw alert("Cannot access image"),new Error("unable to access image data: "+f)}D(h);var H,v,d,U,m,c,k,z,E,b,W,P,u,J,V,p,L,_,Y,R,M,O,w,o,T=h.data,F=Q+Q+1,i=B-1,X=G-1,x=Q+1,e=x*(x+1)/2,l=new n,A=l;for(d=1;F>d;d++)if(A=A.next=new n,d==x)var q=A;A.next=l;var S=null,r=null;k=c=0;var y=g[Q],j=K[Q];for(v=0;G>v;v++){for(p=L=_=Y=z=E=b=W=0,P=x*(R=T[c]),u=x*(M=T[c+1]),J=x*(O=T[c+2]),V=x*(w=T[c+3]),z+=e*R,E+=e*M,b+=e*O,W+=e*w,A=l,d=0;x>d;d++)A.r=R,A.g=M,A.b=O,A.a=w,A=A.next;for(d=1;x>d;d++)U=c+((d>i?i:d)<<2),z+=(A.r=R=T[U])*(o=x-d),E+=(A.g=M=T[U+1])*o,b+=(A.b=O=T[U+2])*o,W+=(A.a=w=T[U+3])*o,p+=R,L+=M,_+=O,Y+=w,A=A.next;for(S=l,r=q,H=0;B>H;H++)T[c]=z*y>>j,T[c+1]=E*y>>j,T[c+2]=b*y>>j,T[c+3]=W*y>>j,z-=P,E-=u,b-=J,W-=V,P-=S.r,u-=S.g,J-=S.b,V-=S.a,U=k+((U=H+Q+1)<i?U:i)<<2,p+=S.r=T[U],L+=S.g=T[U+1],_+=S.b=T[U+2],Y+=S.a=T[U+3],z+=p,E+=L,b+=_,W+=Y,S=S.next,P+=R=r.r,u+=M=r.g,J+=O=r.b,V+=w=r.a,p-=R,L-=M,_-=O,Y-=w,r=r.next,c+=4;k+=B}for(H=0;B>H;H++){for(L=_=Y=p=E=b=W=z=0,c=H<<2,P=x*(R=T[c]),u=x*(M=T[c+1]),J=x*(O=T[c+2]),V=x*(w=T[c+3]),z+=e*R,E+=e*M,b+=e*O,W+=e*w,A=l,d=0;x>d;d++)A.r=R,A.g=M,A.b=O,A.a=w,A=A.next;for(m=B,d=1;Q>=d;d++)c=m+H<<2,z+=(A.r=R=T[c])*(o=x-d),E+=(A.g=M=T[c+1])*o,b+=(A.b=O=T[c+2])*o,W+=(A.a=w=T[c+3])*o,p+=R,L+=M,_+=O,Y+=w,A=A.next,X>d&&(m+=B);for(c=H,S=l,r=q,v=0;G>v;v++)U=c<<2,T[U]=z*y>>j,T[U+1]=E*y>>j,T[U+2]=b*y>>j,T[U+3]=W*y>>j,z-=P,E-=u,b-=J,W-=V,P-=S.r,u-=S.g,J-=S.b,V-=S.a,U=H+((U=v+x)<X?U:X)*B<<2,z+=p+=S.r=T[U],E+=L+=S.g=T[U+1],b+=_+=S.b=T[U+2],W+=Y+=S.a=T[U+3],S=S.next,P+=R=r.r,u+=M=r.g,J+=O=r.b,V+=w=r.a,p-=R,L-=M,_-=O,Y-=w,r=r.next,c+=B}Z(h),s.putImageData(h,C,I)}}function v(r,e,X,L,V,S){if(!(isNaN(S)||1>S)){S|=0;var y,B=document.getElementById(r),t=B.getContext("2d");try{try{y=t.getImageData(e,X,L,V)}catch(T){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),y=t.getImageData(e,X,L,V)}catch(T){throw alert("Cannot access local image"),new Error("unable to access local image data: "+T)}}}catch(T){throw alert("Cannot access image"),new Error("unable to access image data: "+T)}var P,m,A,M,O,C,E,D,q,Y,u,Q,F,x,J,w,f,U,h,a,l=y.data,b=S+S+1,W=L-1,I=V-1,R=S+1,s=R*(R+1)/2,p=new n,v=p;for(A=1;b>A;A++)if(v=v.next=new n,A==R)var Z=v;v.next=p;var $=null,j=null;E=C=0;var N=g[S],o=K[S];for(m=0;V>m;m++){for(x=J=w=D=q=Y=0,u=R*(f=l[C]),Q=R*(U=l[C+1]),F=R*(h=l[C+2]),D+=s*f,q+=s*U,Y+=s*h,v=p,A=0;R>A;A++)v.r=f,v.g=U,v.b=h,v=v.next;for(A=1;R>A;A++)M=C+((A>W?W:A)<<2),D+=(v.r=f=l[M])*(a=R-A),q+=(v.g=U=l[M+1])*a,Y+=(v.b=h=l[M+2])*a,x+=f,J+=U,w+=h,v=v.next;for($=p,j=Z,P=0;L>P;P++)l[C]=D*N>>o,l[C+1]=q*N>>o,l[C+2]=Y*N>>o,D-=u,q-=Q,Y-=F,u-=$.r,Q-=$.g,F-=$.b,M=E+((M=P+S+1)<W?M:W)<<2,x+=$.r=l[M],J+=$.g=l[M+1],w+=$.b=l[M+2],D+=x,q+=J,Y+=w,$=$.next,u+=f=j.r,Q+=U=j.g,F+=h=j.b,x-=f,J-=U,w-=h,j=j.next,C+=4;E+=L}for(P=0;L>P;P++){for(J=w=x=q=Y=D=0,C=P<<2,u=R*(f=l[C]),Q=R*(U=l[C+1]),F=R*(h=l[C+2]),D+=s*f,q+=s*U,Y+=s*h,v=p,A=0;R>A;A++)v.r=f,v.g=U,v.b=h,v=v.next;for(O=L,A=1;S>=A;A++)C=O+P<<2,D+=(v.r=f=l[C])*(a=R-A),q+=(v.g=U=l[C+1])*a,Y+=(v.b=h=l[C+2])*a,x+=f,J+=U,w+=h,v=v.next,I>A&&(O+=L);for(C=P,$=p,j=Z,m=0;V>m;m++)M=C<<2,l[M]=D*N>>o,l[M+1]=q*N>>o,l[M+2]=Y*N>>o,D-=u,q-=Q,Y-=F,u-=$.r,Q-=$.g,F-=$.b,M=P+((M=m+R)<I?M:I)*L<<2,D+=x+=$.r=l[M],q+=J+=$.g=l[M+1],Y+=w+=$.b=l[M+2],$=$.next,u+=f=j.r,Q+=U=j.g,F+=h=j.b,x-=f,J-=U,w-=h,j=j.next,C+=L}t.putImageData(y,e,X)}}function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var g=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],K=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],o={image:$,canvasRGBA:k,canvasRGB:v};"undefined"!=typeof define&&define.amd?define(function(){return o}):"undefined"!=typeof module&&module.exports&&(module.exports=o),M.stackBlur=o}("undefined"!=typeof r?r:this),function(M,U){"undefined"!=typeof define&&define.amd?define("canvgModule",["rgbcolor","stackblur"],U):"undefined"!=typeof module&&module.exports&&(module.exports=U(require("rgbcolor"),require("stackblur"))),M.canvg=U(M.RGBColor,M.stackBlur)}("undefined"!=typeof r?r:this,function(n,p){function C($){var e=[0,0,0],L=function(N,s){var U=$.match(N);null!=U&&(e[s]+=U.length,$=$.replace(N," "))};return $=$.replace(/:not\(([^\)]*)\)/g,"     $1 "),$=$.replace(/{[\s\S]*/gm," "),L(Y,1),L(h,0),L(x,1),L(W,2),L(f,1),L(E,1),$=$.replace(/[\*\s\+>~]/g," "),$=$.replace(/[#\.]/g," "),L(B,2),e.join("")}function b(Q){var b={opts:Q};b.FRAMERATE=30,b.MAX_VIRTUAL_PIXELS=3e4,b.log=function(){},1==b.opts.log&&"undefined"!=typeof console&&(b.log=function(Z){console.log(Z)}),b.init=function(J){var G=0;b.UniqueId=function(){return G++,"canvg"+G},b.Definitions={},b.Styles={},b.StylesSpecificity={},b.Animations=[],b.Images=[],b.ctx=J,b.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(M,z){this.viewPorts.push({width:M,height:z})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(E){return null!=E&&"number"==typeof E?E:"x"==E?this.width():"y"==E?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},b.init(),b.ImagesLoaded=function(){for(var g=0;g<b.Images.length;g++)if(!b.Images[g].loaded)return!1;return!0},b.trim=function(p){return p.replace(/^\s+|\s+$/g,"")},b.compressSpaces=function(U){return U.replace(/[\s\r\t\n]+/gm," ")},b.ajax=function(E){var b;return b=r.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b?(b.open("GET",E,!1),b.send(null),b.responseText):null},b.parseXml=function(E){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var X=new Windows.Data.Xml.Dom.XmlDocument,Q=new Windows.Data.Xml.Dom.XmlLoadSettings;return Q.prohibitDtd=!1,X.loadXml(E,Q),X}if(r.DOMParser){var O=new DOMParser;return O.parseFromString(E,"text/xml")}E=E.replace(/<!DOCTYPE svg[^>]*>/,"");var X=new ActiveXObject("Microsoft.XMLDOM");return X.async="false",X.loadXML(E),X},b.Property=function(Q,b){this.name=Q,this.value=b},b.Property.prototype.getValue=function(){return this.value},b.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},b.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var V=parseFloat(this.value);return(this.value+"").match(/%$/)&&(V/=100),V},b.Property.prototype.valueOrDefault=function(g){return this.hasValue()?this.value:g},b.Property.prototype.numValueOrDefault=function(P){return this.hasValue()?this.numValue():P},b.Property.prototype.addOpacity=function(V){var k=this.value;if(null!=V.value&&""!=V.value&&"string"==typeof this.value){var q=new n(this.value);q.ok&&(k="rgba("+q.r+", "+q.g+", "+q.b+", "+V.numValue()+")")}return new b.Property(this.name,k)},b.Property.prototype.getDefinition=function(){var C=this.value.match(/#([^\)'"]+)/);return C&&(C=C[1]),C||(C=this.value),b.Definitions[C]},b.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},b.Property.prototype.getFillStyleDefinition=function(Z,M){var q=this.getDefinition();if(null!=q&&q.createGradient)return q.createGradient(b.ctx,Z,M);if(null!=q&&q.createPattern){if(q.getHrefAttribute().hasValue()){var L=q.attribute("patternTransform");q=q.getHrefAttribute().getDefinition(),L.hasValue()&&(q.attribute("patternTransform",!0).value=L.value)}return q.createPattern(b.ctx,Z)}return null},b.Property.prototype.getDPI=function(){return 96},b.Property.prototype.getEM=function(e){var w=12,h=new b.Property("fontSize",b.Font.Parse(b.ctx.font).fontSize);return h.hasValue()&&(w=h.toPixels(e)),w},b.Property.prototype.getUnits=function(){var A=this.value+"";return A.replace(/[0-9\.\-]/g,"")},b.Property.prototype.toPixels=function(B,o){if(!this.hasValue())return 0;var y=this.value+"";if(y.match(/em$/))return this.numValue()*this.getEM(B);if(y.match(/ex$/))return this.numValue()*this.getEM(B)/2;if(y.match(/px$/))return this.numValue();if(y.match(/pt$/))return this.numValue()*this.getDPI(B)*(1/72);if(y.match(/pc$/))return 15*this.numValue();if(y.match(/cm$/))return this.numValue()*this.getDPI(B)/2.54;if(y.match(/mm$/))return this.numValue()*this.getDPI(B)/25.4;if(y.match(/in$/))return this.numValue()*this.getDPI(B);if(y.match(/%$/))return this.numValue()*b.ViewPort.ComputeSize(B);var s=this.numValue();return o&&1>s?s*b.ViewPort.ComputeSize(B):s},b.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var L=this.value+"";return L.match(/s$/)?1e3*this.numValue():L.match(/ms$/)?this.numValue():this.numValue()},b.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var $=this.value+"";return $.match(/deg$/)?this.numValue()*(Math.PI/180):$.match(/grad$/)?this.numValue()*(Math.PI/200):$.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var H={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return b.Property.prototype.toTextBaseline=function(){return this.hasValue()?H[this.value]:null},b.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(y,c,s,n,m,q){var B=null!=q?this.Parse(q):this.CreateFont("","","","","",b.ctx.font);return{fontFamily:m||B.fontFamily,fontSize:n||B.fontSize,fontStyle:y||B.fontStyle,fontWeight:s||B.fontWeight,fontVariant:c||B.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var Z=this;this.Parse=function(J){for(var j={},V=b.trim(b.compressSpaces(J||"")).split(" "),r={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},H="",R=0;R<V.length;R++)r.fontStyle||-1==Z.Styles.indexOf(V[R])?r.fontVariant||-1==Z.Variants.indexOf(V[R])?r.fontWeight||-1==Z.Weights.indexOf(V[R])?r.fontSize?"inherit"!=V[R]&&(H+=V[R]):("inherit"!=V[R]&&(j.fontSize=V[R].split("/")[0]),r.fontStyle=r.fontVariant=r.fontWeight=r.fontSize=!0):("inherit"!=V[R]&&(j.fontWeight=V[R]),r.fontStyle=r.fontVariant=r.fontWeight=!0):("inherit"!=V[R]&&(j.fontVariant=V[R]),r.fontStyle=r.fontVariant=!0):("inherit"!=V[R]&&(j.fontStyle=V[R]),r.fontStyle=!0);return""!=H&&(j.fontFamily=H),j}},b.ToNumberArray=function(y){for(var E=b.trim(b.compressSpaces((y||"").replace(/,/g," "))).split(" "),B=0;B<E.length;B++)E[B]=parseFloat(E[B]);return E},b.Point=function(o,S){this.x=o,this.y=S},b.Point.prototype.angleTo=function(V){return Math.atan2(V.y-this.y,V.x-this.x)},b.Point.prototype.applyTransform=function(M){var F=this.x*M[0]+this.y*M[2]+M[4],Q=this.x*M[1]+this.y*M[3]+M[5];this.x=F,this.y=Q},b.CreatePoint=function(E){var R=b.ToNumberArray(E);return new b.Point(R[0],R[1])},b.CreatePath=function(u){for(var F=b.ToNumberArray(u),o=[],q=0;q<F.length;q+=2)o.push(new b.Point(F[q],F[q+1]));return o},b.BoundingBox=function(G,S,F,D){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(F,V){null!=F&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=F,this.x2=F),F<this.x1&&(this.x1=F),F>this.x2&&(this.x2=F)),null!=V&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=V,this.y2=V),V<this.y1&&(this.y1=V),V>this.y2&&(this.y2=V))},this.addX=function(H){this.addPoint(H,null)},this.addY=function(y){this.addPoint(null,y)},this.addBoundingBox=function(w){this.addPoint(w.x1,w.y1),this.addPoint(w.x2,w.y2)},this.addQuadraticCurve=function(f,O,x,U,l,m){var G=f+2/3*(x-f),J=O+2/3*(U-O),L=G+1/3*(l-f),X=J+1/3*(m-O);this.addBezierCurve(f,O,G,L,J,X,l,m)},this.addBezierCurve=function(S,c,P,z,r,d,t,_){var L=[S,c],n=[P,z],Y=[r,d],T=[t,_];this.addPoint(L[0],L[1]),this.addPoint(T[0],T[1]);for(var U=0;1>=U;U++){var D=function(h){return Math.pow(1-h,3)*L[U]+3*Math.pow(1-h,2)*h*n[U]+3*(1-h)*Math.pow(h,2)*Y[U]+Math.pow(h,3)*T[U]},i=6*L[U]-12*n[U]+6*Y[U],O=-3*L[U]+9*n[U]-9*Y[U]+3*T[U],E=3*n[U]-3*L[U];if(0!=O){var k=Math.pow(i,2)-4*E*O;if(!(0>k)){var h=(-i+Math.sqrt(k))/(2*O);h>0&&1>h&&(0==U&&this.addX(D(h)),1==U&&this.addY(D(h)));var R=(-i-Math.sqrt(k))/(2*O);R>0&&1>R&&(0==U&&this.addX(D(R)),1==U&&this.addY(D(R)))}}else{if(0==i)continue;var X=-E/i;X>0&&1>X&&(0==U&&this.addX(D(X)),1==U&&this.addY(D(X)))}}},this.isPointInBox=function(n,D){return this.x1<=n&&n<=this.x2&&this.y1<=D&&D<=this.y2},this.addPoint(G,S),this.addPoint(F,D)},b.Transform=function(h){var L=this;this.Type={},this.Type.translate=function(e){this.p=b.CreatePoint(e),this.apply=function(r){r.translate(this.p.x||0,this.p.y||0)},this.unapply=function(h){h.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(z){z.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(k){var N=b.ToNumberArray(k);this.angle=new b.Property("angle",N[0]),this.cx=N[1]||0,this.cy=N[2]||0,this.apply=function(y){y.translate(this.cx,this.cy),y.rotate(this.angle.toRadians()),y.translate(-this.cx,-this.cy)},this.unapply=function(F){F.translate(this.cx,this.cy),F.rotate(-1*this.angle.toRadians()),F.translate(-this.cx,-this.cy)},this.applyToPoint=function(p){var M=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),p.applyTransform([Math.cos(M),Math.sin(M),-Math.sin(M),Math.cos(M),0,0]),p.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(U){this.p=b.CreatePoint(U),this.apply=function(u){u.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(m){m.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(I){I.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(e){this.m=b.ToNumberArray(e),this.apply=function(k){k.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(Q){var V=this.m[0],W=this.m[2],u=this.m[4],g=this.m[1],I=this.m[3],N=this.m[5],b=0,J=0,p=1,F=1/(V*(I*p-N*J)-W*(g*p-N*b)+u*(g*J-I*b));Q.transform(F*(I*p-N*J),F*(N*b-g*p),F*(u*J-W*p),F*(V*p-u*b),F*(W*N-u*I),F*(u*g-V*N))},this.applyToPoint=function(o){o.applyTransform(this.m)}},this.Type.SkewBase=function(e){this.base=L.Type.matrix,this.base(e),this.angle=new b.Property("angle",e)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(b){this.base=L.Type.SkewBase,this.base(b),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(l){this.base=L.Type.SkewBase,this.base(l),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(m){for(var N=0;N<this.transforms.length;N++)this.transforms[N].apply(m)},this.unapply=function(F){for(var o=this.transforms.length-1;o>=0;o--)this.transforms[o].unapply(F)},this.applyToPoint=function(I){for(var s=0;s<this.transforms.length;s++)this.transforms[s].applyToPoint(I)};for(var c=b.trim(b.compressSpaces(h)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),v=0;v<c.length;v++){var g=b.trim(c[v].split("(")[0]),T=c[v].split("(")[1].replace(")",""),Q=this.Type[g];if("undefined"!=typeof Q){var u=new Q(T);u.type=g,this.transforms.push(u)}}},b.AspectRatio=function(M,T,C,c,P,w,B,f,i,k){T=b.compressSpaces(T),T=T.replace(/^defer\s/,"");var J=T.split(" ")[0]||"xMidYMid",_=T.split(" ")[1]||"meet",W=C/c,D=P/w,o=Math.min(W,D),e=Math.max(W,D);"meet"==_&&(c*=o,w*=o),"slice"==_&&(c*=e,w*=e),i=new b.Property("refX",i),k=new b.Property("refY",k),i.hasValue()&&k.hasValue()?M.translate(-o*i.toPixels("x"),-o*k.toPixels("y")):(J.match(/^xMid/)&&("meet"==_&&o==D||"slice"==_&&e==D)&&M.translate(C/2-c/2,0),J.match(/YMid$/)&&("meet"==_&&o==W||"slice"==_&&e==W)&&M.translate(0,P/2-w/2),J.match(/^xMax/)&&("meet"==_&&o==D||"slice"==_&&e==D)&&M.translate(C-c,0),J.match(/YMax$/)&&("meet"==_&&o==W||"slice"==_&&e==W)&&M.translate(0,P-w)),"none"==J?M.scale(W,D):"meet"==_?M.scale(o,o):"slice"==_&&M.scale(e,e),M.translate(null==B?0:-B,null==f?0:-f)
},b.Element={},b.EmptyProperty=new b.Property("EMPTY",""),b.Element.ElementBase=function(M){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(Q,u){var T=this.attributes[Q];return null!=T?T:(1==u&&(T=new b.Property(Q,""),this.attributes[Q]=T),T||b.EmptyProperty)},this.getHrefAttribute=function(){for(var I in this.attributes)if("href"==I||I.match(/:href$/))return this.attributes[I];return b.EmptyProperty},this.style=function(U,o,z){var l=this.styles[U];if(null!=l)return l;var Y=this.attribute(U);if(null!=Y&&Y.hasValue())return this.styles[U]=Y,Y;if(1!=z){var $=this.parent;if(null!=$){var c=$.style(U);if(null!=c&&c.hasValue())return c}}return 1==o&&(l=new b.Property(U,""),this.styles[U]=l),l||b.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(e.save(),this.style("mask").hasValue()){var k=this.style("mask").getDefinition();null!=k&&k.apply(e,this)}else if(this.style("filter").hasValue()){var o=this.style("filter").getDefinition();null!=o&&o.apply(e,this)}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(B){for(var _=0;_<this.children.length;_++)this.children[_].render(B)},this.addChild=function(p,m){var O=p;m&&(O=b.CreateElement(p)),O.parent=this,"title"!=O.type&&this.children.push(O)},this.addStylesFromStyleDefinition=function(){for(var _ in b.Styles)if("@"!=_[0]&&K(M,_)){var p=b.Styles[_],d=b.StylesSpecificity[_];if(null!=p)for(var H in p){var l=this.stylesSpecificity[H];"undefined"==typeof l&&(l="000"),d>l&&(this.styles[H]=p[H],this.stylesSpecificity[H]=d)}}};var k=new RegExp("^[A-Z-]+$"),r=function(n){return k.test(n)?n.toLowerCase():n};if(null!=M&&1==M.nodeType){for(var i=0;i<M.attributes.length;i++){var d=M.attributes[i],f=r(d.nodeName);this.attributes[f]=new b.Property(f,d.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue())for(var Z=this.attribute("style").value.split(";"),i=0;i<Z.length;i++)if(""!=b.trim(Z[i])){var y=Z[i].split(":"),H=b.trim(y[0]),B=b.trim(y[1]);this.styles[H]=new b.Property(H,B)}this.attribute("id").hasValue()&&null==b.Definitions[this.attribute("id").value]&&(b.Definitions[this.attribute("id").value]=this);for(var i=0;i<M.childNodes.length;i++){var P=M.childNodes[i];if(1==P.nodeType&&this.addChild(P,!0),this.captureTextNodes&&(3==P.nodeType||4==P.nodeType)){var u=P.value||P.text||P.textContent||"";""!=b.compressSpaces(u)&&this.addChild(new b.Element.tspan(P),!1)}}}},b.Element.RenderedElementBase=function(o){this.base=b.Element.ElementBase,this.base(o),this.setContext=function(f){if(this.style("fill").isUrlDefinition()){var j=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=j&&(f.fillStyle=j)}else if(this.style("fill").hasValue()){var S=this.style("fill");"currentColor"==S.value&&(S.value=this.style("color").value),"inherit"!=S.value&&(f.fillStyle="none"==S.value?"rgba(0,0,0,0)":S.value)}if(this.style("fill-opacity").hasValue()){var S=new b.Property("fill",f.fillStyle);S=S.addOpacity(this.style("fill-opacity")),f.fillStyle=S.value}if(this.style("stroke").isUrlDefinition()){var j=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=j&&(f.strokeStyle=j)}else if(this.style("stroke").hasValue()){var R=this.style("stroke");"currentColor"==R.value&&(R.value=this.style("color").value),"inherit"!=R.value&&(f.strokeStyle="none"==R.value?"rgba(0,0,0,0)":R.value)}if(this.style("stroke-opacity").hasValue()){var R=new b.Property("stroke",f.strokeStyle);R=R.addOpacity(this.style("stroke-opacity")),f.strokeStyle=R.value}if(this.style("stroke-width").hasValue()){var h=this.style("stroke-width").toPixels();f.lineWidth=0==h?.001:h}if(this.style("stroke-linecap").hasValue()&&(f.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(f.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(f.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var d=b.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof f.setLineDash?f.setLineDash(d):"undefined"!=typeof f.webkitLineDash?f.webkitLineDash=d:"undefined"==typeof f.mozDash||1==d.length&&0==d[0]||(f.mozDash=d);var c=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof f.lineDashOffset?f.lineDashOffset=c:"undefined"!=typeof f.webkitLineDashOffset?f.webkitLineDashOffset=c:"undefined"!=typeof f.mozDashOffset&&(f.mozDashOffset=c)}if("undefined"!=typeof f.font&&(f.font=b.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()){var n=new b.Transform(this.style("transform",!1,!0).value);n.apply(f)}if(this.style("clip-path",!1,!0).hasValue()){var C=this.style("clip-path",!1,!0).getDefinition();null!=C&&C.apply(f)}this.style("opacity").hasValue()&&(f.globalAlpha=this.style("opacity").numValue())}},b.Element.RenderedElementBase.prototype=new b.Element.ElementBase,b.Element.PathElementBase=function(q){this.base=b.Element.RenderedElementBase,this.base(q),this.path=function(m){return null!=m&&m.beginPath(),new b.BoundingBox},this.renderChildren=function(Z){this.path(Z),b.Mouse.checkPath(this,Z),""!=Z.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?Z.fill(this.style("fill-rule").value):Z.fill()),""!=Z.strokeStyle&&Z.stroke();var F=this.getMarkers();if(null!=F){if(this.style("marker-start").isUrlDefinition()){var f=this.style("marker-start").getDefinition();f.render(Z,F[0][0],F[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var f=this.style("marker-mid").getDefinition(),X=1;X<F.length-1;X++)f.render(Z,F[X][0],F[X][1]);if(this.style("marker-end").isUrlDefinition()){var f=this.style("marker-end").getDefinition();f.render(Z,F[F.length-1][0],F[F.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},b.Element.PathElementBase.prototype=new b.Element.RenderedElementBase,b.Element.svg=function(Q){this.base=b.Element.RenderedElementBase,this.base(Q),this.baseClearContext=this.clearContext,this.clearContext=function(H){this.baseClearContext(H),b.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(f){f.strokeStyle="rgba(0,0,0,0)",f.lineCap="butt",f.lineJoin="miter",f.miterLimit=4,"undefined"!=typeof f.font&&"undefined"!=typeof r.getComputedStyle&&(f.font=r.getComputedStyle(f.canvas).getPropertyValue("font")),this.baseSetContext(f),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),f.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var C=b.ViewPort.width(),v=b.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){C=this.attribute("width").toPixels("x"),v=this.attribute("height").toPixels("y");var z=0,U=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(z=-this.attribute("refX").toPixels("x"),U=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(f.beginPath(),f.moveTo(z,U),f.lineTo(C,U),f.lineTo(C,v),f.lineTo(z,v),f.closePath(),f.clip())}if(b.ViewPort.SetCurrent(C,v),this.attribute("viewBox").hasValue()){var Z=b.ToNumberArray(this.attribute("viewBox").value),g=Z[0],w=Z[1];C=Z[2],v=Z[3],b.AspectRatio(f,this.attribute("preserveAspectRatio").value,b.ViewPort.width(),C,b.ViewPort.height(),v,g,w,this.attribute("refX").value,this.attribute("refY").value),b.ViewPort.RemoveCurrent(),b.ViewPort.SetCurrent(Z[2],Z[3])}}},b.Element.svg.prototype=new b.Element.RenderedElementBase,b.Element.rect=function(A){this.base=b.Element.PathElementBase,this.base(A),this.path=function(f){var s=this.attribute("x").toPixels("x"),S=this.attribute("y").toPixels("y"),g=this.attribute("width").toPixels("x"),U=this.attribute("height").toPixels("y"),T=this.attribute("rx").toPixels("x"),q=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(q=T),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(T=q),T=Math.min(T,g/2),q=Math.min(q,U/2),null!=f&&(f.beginPath(),f.moveTo(s+T,S),f.lineTo(s+g-T,S),f.quadraticCurveTo(s+g,S,s+g,S+q),f.lineTo(s+g,S+U-q),f.quadraticCurveTo(s+g,S+U,s+g-T,S+U),f.lineTo(s+T,S+U),f.quadraticCurveTo(s,S+U,s,S+U-q),f.lineTo(s,S+q),f.quadraticCurveTo(s,S,s+T,S),f.closePath()),new b.BoundingBox(s,S,s+g,S+U)}},b.Element.rect.prototype=new b.Element.PathElementBase,b.Element.circle=function(a){this.base=b.Element.PathElementBase,this.base(a),this.path=function(z){var M=this.attribute("cx").toPixels("x"),t=this.attribute("cy").toPixels("y"),T=this.attribute("r").toPixels();return null!=z&&(z.beginPath(),z.arc(M,t,T,0,2*Math.PI,!0),z.closePath()),new b.BoundingBox(M-T,t-T,M+T,t+T)}},b.Element.circle.prototype=new b.Element.PathElementBase,b.Element.ellipse=function(Z){this.base=b.Element.PathElementBase,this.base(Z),this.path=function(v){var W=4*((Math.sqrt(2)-1)/3),X=this.attribute("rx").toPixels("x"),I=this.attribute("ry").toPixels("y"),j=this.attribute("cx").toPixels("x"),P=this.attribute("cy").toPixels("y");return null!=v&&(v.beginPath(),v.moveTo(j,P-I),v.bezierCurveTo(j+W*X,P-I,j+X,P-W*I,j+X,P),v.bezierCurveTo(j+X,P+W*I,j+W*X,P+I,j,P+I),v.bezierCurveTo(j-W*X,P+I,j-X,P+W*I,j-X,P),v.bezierCurveTo(j-X,P-W*I,j-W*X,P-I,j,P-I),v.closePath()),new b.BoundingBox(j-X,P-I,j+X,P+I)}},b.Element.ellipse.prototype=new b.Element.PathElementBase,b.Element.line=function(D){this.base=b.Element.PathElementBase,this.base(D),this.getPoints=function(){return[new b.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new b.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(v){var Z=this.getPoints();return null!=v&&(v.beginPath(),v.moveTo(Z[0].x,Z[0].y),v.lineTo(Z[1].x,Z[1].y)),new b.BoundingBox(Z[0].x,Z[0].y,Z[1].x,Z[1].y)},this.getMarkers=function(){var X=this.getPoints(),y=X[0].angleTo(X[1]);return[[X[0],y],[X[1],y]]}},b.Element.line.prototype=new b.Element.PathElementBase,b.Element.polyline=function(z){this.base=b.Element.PathElementBase,this.base(z),this.points=b.CreatePath(this.attribute("points").value),this.path=function(t){var F=new b.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var j=1;j<this.points.length;j++)F.addPoint(this.points[j].x,this.points[j].y),null!=t&&t.lineTo(this.points[j].x,this.points[j].y);return F},this.getMarkers=function(){for(var O=[],Q=0;Q<this.points.length-1;Q++)O.push([this.points[Q],this.points[Q].angleTo(this.points[Q+1])]);return O.length>0&&O.push([this.points[this.points.length-1],O[O.length-1][1]]),O}},b.Element.polyline.prototype=new b.Element.PathElementBase,b.Element.polygon=function(G){this.base=b.Element.polyline,this.base(G),this.basePath=this.path,this.path=function(j){var a=this.basePath(j);return null!=j&&(j.lineTo(this.points[0].x,this.points[0].y),j.closePath()),a}},b.Element.polygon.prototype=new b.Element.polyline,b.Element.path=function(U){this.base=b.Element.PathElementBase,this.base(U);var S=this.attribute("d").value;S=S.replace(/,/gm," ");for(var Y=0;2>Y;Y++)S=S.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");S=S.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),S=S.replace(/([0-9])([+\-])/gm,"$1 $2");for(var Y=0;2>Y;Y++)S=S.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");S=S.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),S=b.compressSpaces(S),S=b.trim(S),this.PathParser=new function(U){this.tokens=U.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new b.Point(0,0),this.control=new b.Point(0,0),this.current=new b.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var O=new b.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(O)},this.getAsControlPoint=function(){var Q=this.getPoint();return this.control=Q,Q},this.getAsCurrentPoint=function(){var K=this.getPoint();return this.current=K,K},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var L=new b.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return L},this.makeAbsolute=function(g){return this.isRelativeCommand()&&(g.x+=this.current.x,g.y+=this.current.y),g},this.addMarker=function(R,A,Z){null!=Z&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(Z)),this.addMarkerAngle(R,null==A?null:A.angleTo(R))},this.addMarkerAngle=function(J,j){this.points.push(J),this.angles.push(j)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var X=0;X<this.angles.length;X++)if(null==this.angles[X])for(var m=X+1;m<this.angles.length;m++)if(null!=this.angles[m]){this.angles[X]=this.angles[m];break}return this.angles}}(S),this.path=function(c){var F=this.PathParser;F.reset();var Y=new b.BoundingBox;for(null!=c&&c.beginPath();!F.isEnd();)switch(F.nextCommand(),F.command){case"M":case"m":var d=F.getAsCurrentPoint();for(F.addMarker(d),Y.addPoint(d.x,d.y),null!=c&&c.moveTo(d.x,d.y),F.start=F.current;!F.isCommandOrEnd();){var d=F.getAsCurrentPoint();F.addMarker(d,F.start),Y.addPoint(d.x,d.y),null!=c&&c.lineTo(d.x,d.y)}break;case"L":case"l":for(;!F.isCommandOrEnd();){var R=F.current,d=F.getAsCurrentPoint();F.addMarker(d,R),Y.addPoint(d.x,d.y),null!=c&&c.lineTo(d.x,d.y)}break;case"H":case"h":for(;!F.isCommandOrEnd();){var k=new b.Point((F.isRelativeCommand()?F.current.x:0)+F.getScalar(),F.current.y);F.addMarker(k,F.current),F.current=k,Y.addPoint(F.current.x,F.current.y),null!=c&&c.lineTo(F.current.x,F.current.y)}break;case"V":case"v":for(;!F.isCommandOrEnd();){var k=new b.Point(F.current.x,(F.isRelativeCommand()?F.current.y:0)+F.getScalar());F.addMarker(k,F.current),F.current=k,Y.addPoint(F.current.x,F.current.y),null!=c&&c.lineTo(F.current.x,F.current.y)}break;case"C":case"c":for(;!F.isCommandOrEnd();){var X=F.current,U=F.getPoint(),C=F.getAsControlPoint(),t=F.getAsCurrentPoint();F.addMarker(t,C,U),Y.addBezierCurve(X.x,X.y,U.x,U.y,C.x,C.y,t.x,t.y),null!=c&&c.bezierCurveTo(U.x,U.y,C.x,C.y,t.x,t.y)}break;case"S":case"s":for(;!F.isCommandOrEnd();){var X=F.current,U=F.getReflectedControlPoint(),C=F.getAsControlPoint(),t=F.getAsCurrentPoint();F.addMarker(t,C,U),Y.addBezierCurve(X.x,X.y,U.x,U.y,C.x,C.y,t.x,t.y),null!=c&&c.bezierCurveTo(U.x,U.y,C.x,C.y,t.x,t.y)}break;case"Q":case"q":for(;!F.isCommandOrEnd();){var X=F.current,C=F.getAsControlPoint(),t=F.getAsCurrentPoint();F.addMarker(t,C,C),Y.addQuadraticCurve(X.x,X.y,C.x,C.y,t.x,t.y),null!=c&&c.quadraticCurveTo(C.x,C.y,t.x,t.y)}break;case"T":case"t":for(;!F.isCommandOrEnd();){var X=F.current,C=F.getReflectedControlPoint();F.control=C;var t=F.getAsCurrentPoint();F.addMarker(t,C,C),Y.addQuadraticCurve(X.x,X.y,C.x,C.y,t.x,t.y),null!=c&&c.quadraticCurveTo(C.x,C.y,t.x,t.y)}break;case"A":case"a":for(;!F.isCommandOrEnd();){var X=F.current,V=F.getScalar(),P=F.getScalar(),S=F.getScalar()*(Math.PI/180),H=F.getScalar(),i=F.getScalar(),t=F.getAsCurrentPoint(),A=new b.Point(Math.cos(S)*(X.x-t.x)/2+Math.sin(S)*(X.y-t.y)/2,-Math.sin(S)*(X.x-t.x)/2+Math.cos(S)*(X.y-t.y)/2),$=Math.pow(A.x,2)/Math.pow(V,2)+Math.pow(A.y,2)/Math.pow(P,2);$>1&&(V*=Math.sqrt($),P*=Math.sqrt($));var M=(H==i?-1:1)*Math.sqrt((Math.pow(V,2)*Math.pow(P,2)-Math.pow(V,2)*Math.pow(A.y,2)-Math.pow(P,2)*Math.pow(A.x,2))/(Math.pow(V,2)*Math.pow(A.y,2)+Math.pow(P,2)*Math.pow(A.x,2)));isNaN(M)&&(M=0);var y=new b.Point(M*V*A.y/P,M*-P*A.x/V),f=new b.Point((X.x+t.x)/2+Math.cos(S)*y.x-Math.sin(S)*y.y,(X.y+t.y)/2+Math.sin(S)*y.x+Math.cos(S)*y.y),Q=function(V){return Math.sqrt(Math.pow(V[0],2)+Math.pow(V[1],2))},l=function(W,L){return(W[0]*L[0]+W[1]*L[1])/(Q(W)*Q(L))},L=function(Q,P){return(Q[0]*P[1]<Q[1]*P[0]?-1:1)*Math.acos(l(Q,P))},D=L([1,0],[(A.x-y.x)/V,(A.y-y.y)/P]),N=[(A.x-y.x)/V,(A.y-y.y)/P],s=[(-A.x-y.x)/V,(-A.y-y.y)/P],T=L(N,s);l(N,s)<=-1&&(T=Math.PI),l(N,s)>=1&&(T=0);var J=1-i?1:-1,E=D+J*(T/2),x=new b.Point(f.x+V*Math.cos(E),f.y+P*Math.sin(E));if(F.addMarkerAngle(x,E-J*Math.PI/2),F.addMarkerAngle(t,E-J*Math.PI),Y.addPoint(t.x,t.y),null!=c){var l=V>P?V:P,h=V>P?1:V/P,w=V>P?P/V:1;c.translate(f.x,f.y),c.rotate(S),c.scale(h,w),c.arc(0,0,l,D,D+T,1-i),c.scale(1/h,1/w),c.rotate(-S),c.translate(-f.x,-f.y)}}break;case"Z":case"z":null!=c&&c.closePath(),F.current=F.start}return Y},this.getMarkers=function(){for(var k=this.PathParser.getMarkerPoints(),q=this.PathParser.getMarkerAngles(),P=[],K=0;K<k.length;K++)P.push([k[K],q[K]]);return P}},b.Element.path.prototype=new b.Element.PathElementBase,b.Element.pattern=function(C){this.base=b.Element.ElementBase,this.base(C),this.createPattern=function(v){var _=this.attribute("width").toPixels("x",!0),t=this.attribute("height").toPixels("y",!0),Y=new b.Element.svg;Y.attributes.viewBox=new b.Property("viewBox",this.attribute("viewBox").value),Y.attributes.width=new b.Property("width",_+"px"),Y.attributes.height=new b.Property("height",t+"px"),Y.attributes.transform=new b.Property("transform",this.attribute("patternTransform").value),Y.children=this.children;var e=document.createElement("canvas");e.width=_,e.height=t;var c=e.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&c.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var T=-1;1>=T;T++)for(var x=-1;1>=x;x++)c.save(),Y.attributes.x=new b.Property("x",T*e.width),Y.attributes.y=new b.Property("y",x*e.height),Y.render(c),c.restore();var h=v.createPattern(e,"repeat");return h}},b.Element.pattern.prototype=new b.Element.ElementBase,b.Element.marker=function(z){this.base=b.Element.ElementBase,this.base(z),this.baseRender=this.render,this.render=function(g,A,J){g.translate(A.x,A.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&g.rotate(J),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&g.scale(g.lineWidth,g.lineWidth),g.save();var n=new b.Element.svg;n.attributes.viewBox=new b.Property("viewBox",this.attribute("viewBox").value),n.attributes.refX=new b.Property("refX",this.attribute("refX").value),n.attributes.refY=new b.Property("refY",this.attribute("refY").value),n.attributes.width=new b.Property("width",this.attribute("markerWidth").value),n.attributes.height=new b.Property("height",this.attribute("markerHeight").value),n.attributes.fill=new b.Property("fill",this.attribute("fill").valueOrDefault("black")),n.attributes.stroke=new b.Property("stroke",this.attribute("stroke").valueOrDefault("none")),n.children=this.children,n.render(g),g.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&g.scale(1/g.lineWidth,1/g.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&g.rotate(-J),g.translate(-A.x,-A.y)}},b.Element.marker.prototype=new b.Element.ElementBase,b.Element.defs=function(v){this.base=b.Element.ElementBase,this.base(v),this.render=function(){}},b.Element.defs.prototype=new b.Element.ElementBase,b.Element.GradientBase=function(M){this.base=b.Element.ElementBase,this.base(M),this.stops=[];for(var g=0;g<this.children.length;g++){var H=this.children[g];"stop"==H.type&&this.stops.push(H)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(S){for(var o=0;o<this.attributesToInherit.length;o++){var e=this.attributesToInherit[o];!this.attribute(e).hasValue()&&S.attribute(e).hasValue()&&(this.attribute(e,!0).value=S.attribute(e).value)}},this.createGradient=function(r,R,x){var W=this;this.getHrefAttribute().hasValue()&&(W=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(W));var y=function(h){if(x.hasValue()){var p=new b.Property("color",h);return p.addOpacity(x).value}return h},L=this.getGradient(r,R);if(null==L)return y(W.stops[W.stops.length-1].color);for(var A=0;A<W.stops.length;A++)L.addColorStop(W.stops[A].offset,y(W.stops[A].color));if(this.attribute("gradientTransform").hasValue()){var f=b.ViewPort.viewPorts[0],V=new b.Element.rect;V.attributes.x=new b.Property("x",-b.MAX_VIRTUAL_PIXELS/3),V.attributes.y=new b.Property("y",-b.MAX_VIRTUAL_PIXELS/3),V.attributes.width=new b.Property("width",b.MAX_VIRTUAL_PIXELS),V.attributes.height=new b.Property("height",b.MAX_VIRTUAL_PIXELS);var u=new b.Element.g;u.attributes.transform=new b.Property("transform",this.attribute("gradientTransform").value),u.children=[V];var w=new b.Element.svg;w.attributes.x=new b.Property("x",0),w.attributes.y=new b.Property("y",0),w.attributes.width=new b.Property("width",f.width),w.attributes.height=new b.Property("height",f.height),w.children=[u];var Y=document.createElement("canvas");Y.width=f.width,Y.height=f.height;var c=Y.getContext("2d");return c.fillStyle=L,w.render(c),c.createPattern(Y,"no-repeat")}return L}},b.Element.GradientBase.prototype=new b.Element.ElementBase,b.Element.linearGradient=function(u){this.base=b.Element.GradientBase,this.base(u),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(S,k){var z="objectBoundingBox"==this.gradientUnits()?k.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var Q="objectBoundingBox"==this.gradientUnits()?z.x()+z.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),v="objectBoundingBox"==this.gradientUnits()?z.y()+z.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),s="objectBoundingBox"==this.gradientUnits()?z.x()+z.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),Y="objectBoundingBox"==this.gradientUnits()?z.y()+z.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return Q==s&&v==Y?null:S.createLinearGradient(Q,v,s,Y)}},b.Element.linearGradient.prototype=new b.Element.GradientBase,b.Element.radialGradient=function(l){this.base=b.Element.GradientBase,this.base(l),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(i,U){var u=U.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var Z="objectBoundingBox"==this.gradientUnits()?u.x()+u.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),n="objectBoundingBox"==this.gradientUnits()?u.y()+u.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),y=Z,N=n;this.attribute("fx").hasValue()&&(y="objectBoundingBox"==this.gradientUnits()?u.x()+u.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(N="objectBoundingBox"==this.gradientUnits()?u.y()+u.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var S="objectBoundingBox"==this.gradientUnits()?(u.width()+u.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return i.createRadialGradient(y,N,0,Z,n,S)}},b.Element.radialGradient.prototype=new b.Element.GradientBase,b.Element.stop=function(q){this.base=b.Element.ElementBase,this.base(q),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var J=this.style("stop-color",!0);""===J.value&&(J.value="#000"),this.style("stop-opacity").hasValue()&&(J=J.addOpacity(this.style("stop-opacity"))),this.color=J.value},b.Element.stop.prototype=new b.Element.ElementBase,b.Element.AnimateBase=function(K){this.base=b.Element.ElementBase,this.base(K),b.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var s=this.attribute("attributeType").value,S=this.attribute("attributeName").value;return"CSS"==s?this.parent.style(S,!0):this.parent.attribute(S,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(k){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+k;var O=!1;if(this.begin<this.duration){var H=this.calcValue();if(this.attribute("type").hasValue()){var Y=this.attribute("type").value;H=Y+"("+H+")"}this.getProperty().value=H,O=!0}return O},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var m={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var r=m.progress*(this.values.value.length-1),Q=Math.floor(r),i=Math.ceil(r);m.from=new b.Property("from",parseFloat(this.values.value[Q])),m.to=new b.Property("to",parseFloat(this.values.value[i])),m.progress=(r-Q)/(i-Q)}else m.from=this.from,m.to=this.to;return m}},b.Element.AnimateBase.prototype=new b.Element.ElementBase,b.Element.animate=function(y){this.base=b.Element.AnimateBase,this.base(y),this.calcValue=function(){var H=this.progress(),u=H.from.numValue()+(H.to.numValue()-H.from.numValue())*H.progress;return u+this.initialUnits}},b.Element.animate.prototype=new b.Element.AnimateBase,b.Element.animateColor=function(P){this.base=b.Element.AnimateBase,this.base(P),this.calcValue=function(){var $=this.progress(),F=new n($.from.value),w=new n($.to.value);if(F.ok&&w.ok){var y=F.r+(w.r-F.r)*$.progress,S=F.g+(w.g-F.g)*$.progress,I=F.b+(w.b-F.b)*$.progress;return"rgb("+parseInt(y,10)+","+parseInt(S,10)+","+parseInt(I,10)+")"}return this.attribute("from").value}},b.Element.animateColor.prototype=new b.Element.AnimateBase,b.Element.animateTransform=function(h){this.base=b.Element.AnimateBase,this.base(h),this.calcValue=function(){for(var h=this.progress(),G=b.ToNumberArray(h.from.value),l=b.ToNumberArray(h.to.value),j="",D=0;D<G.length;D++)j+=G[D]+(l[D]-G[D])*h.progress+" ";return j}},b.Element.animateTransform.prototype=new b.Element.animate,b.Element.font=function(z){this.base=b.Element.ElementBase,this.base(z),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var W=0;W<this.children.length;W++){var R=this.children[W];"font-face"==R.type?(this.fontFace=R,R.style("font-family").hasValue()&&(b.Definitions[R.style("font-family").value]=this)):"missing-glyph"==R.type?this.missingGlyph=R:"glyph"==R.type&&(""!=R.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[R.unicode]&&(this.glyphs[R.unicode]=[]),this.glyphs[R.unicode][R.arabicForm]=R):this.glyphs[R.unicode]=R)}},b.Element.font.prototype=new b.Element.ElementBase,b.Element.fontface=function(j){this.base=b.Element.ElementBase,this.base(j),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},b.Element.fontface.prototype=new b.Element.ElementBase,b.Element.missingglyph=function(T){this.base=b.Element.path,this.base(T),this.horizAdvX=0},b.Element.missingglyph.prototype=new b.Element.path,b.Element.glyph=function(I){this.base=b.Element.path,this.base(I),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},b.Element.glyph.prototype=new b.Element.path,b.Element.text=function(N){this.captureTextNodes=!0,this.base=b.Element.RenderedElementBase,this.base(N),this.baseSetContext=this.setContext,this.setContext=function(c){this.baseSetContext(c);var Y=this.style("dominant-baseline").toTextBaseline();null==Y&&(Y=this.style("alignment-baseline").toTextBaseline()),null!=Y&&(c.textBaseline=Y)},this.getBoundingBox=function(){var g=this.attribute("x").toPixels("x"),K=this.attribute("y").toPixels("y"),U=this.parent.style("font-size").numValueOrDefault(b.Font.Parse(b.ctx.font).fontSize);return new b.BoundingBox(g,K-U,g+Math.floor(2*U/3)*this.children[0].getText().length,K)},this.renderChildren=function(E){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(E,this,0);for(var z=0;z<this.children.length;z++)this.renderChild(E,this,this,z)},this.getAnchorDelta=function(Q,B,j){var I=this.style("text-anchor").valueOrDefault("start");if("start"!=I){for(var c=0,u=j;u<B.children.length;u++){var S=B.children[u];if(u>j&&S.attribute("x").hasValue())break;c+=S.measureTextRecursive(Q)}return-1*("end"==I?c:c/2)}return 0},this.renderChild=function(s,X,C,V){var i=C.children[V];i.attribute("x").hasValue()?(i.x=i.attribute("x").toPixels("x")+X.getAnchorDelta(s,C,V),i.attribute("dx").hasValue()&&(i.x+=i.attribute("dx").toPixels("x"))):(i.attribute("dx").hasValue()&&(X.x+=i.attribute("dx").toPixels("x")),i.x=X.x),X.x=i.x+i.measureText(s),i.attribute("y").hasValue()?(i.y=i.attribute("y").toPixels("y"),i.attribute("dy").hasValue()&&(i.y+=i.attribute("dy").toPixels("y"))):(i.attribute("dy").hasValue()&&(X.y+=i.attribute("dy").toPixels("y")),i.y=X.y),X.y=i.y,i.render(s);for(var V=0;V<i.children.length;V++)X.renderChild(s,X,i,V)}},b.Element.text.prototype=new b.Element.RenderedElementBase,b.Element.TextElementBase=function(A){this.base=b.Element.RenderedElementBase,this.base(A),this.getGlyph=function(j,d,S){var h=d[S],U=null;if(j.isArabic){var D="isolated";(0==S||" "==d[S-1])&&S<d.length-2&&" "!=d[S+1]&&(D="terminal"),S>0&&" "!=d[S-1]&&S<d.length-2&&" "!=d[S+1]&&(D="medial"),S>0&&" "!=d[S-1]&&(S==d.length-1||" "==d[S+1])&&(D="initial"),"undefined"!=typeof j.glyphs[h]&&(U=j.glyphs[h][D],null==U&&"glyph"==j.glyphs[h].type&&(U=j.glyphs[h]))
}else U=j.glyphs[h];return null==U&&(U=j.missingGlyph),U},this.renderChildren=function(s){var g=this.parent.style("font-family").getDefinition();if(null==g)""!=s.fillStyle&&s.fillText(b.compressSpaces(this.getText()),this.x,this.y),""!=s.strokeStyle&&s.strokeText(b.compressSpaces(this.getText()),this.x,this.y);else{var M=this.parent.style("font-size").numValueOrDefault(b.Font.Parse(b.ctx.font).fontSize),e=this.parent.style("font-style").valueOrDefault(b.Font.Parse(b.ctx.font).fontStyle),R=this.getText();g.isRTL&&(R=R.split("").reverse().join(""));for(var V=b.ToNumberArray(this.parent.attribute("dx").value),c=0;c<R.length;c++){var y=this.getGlyph(g,R,c),x=M/g.fontFace.unitsPerEm;s.translate(this.x,this.y),s.scale(x,-x);var W=s.lineWidth;s.lineWidth=s.lineWidth*g.fontFace.unitsPerEm/M,"italic"==e&&s.transform(1,0,.4,1,0,0),y.render(s),"italic"==e&&s.transform(1,0,-.4,1,0,0),s.lineWidth=W,s.scale(1/x,-1/x),s.translate(-this.x,-this.y),this.x+=M*(y.horizAdvX||g.horizAdvX)/g.fontFace.unitsPerEm,"undefined"==typeof V[c]||isNaN(V[c])||(this.x+=V[c])}}},this.getText=function(){},this.measureTextRecursive=function(I){for(var x=this.measureText(I),T=0;T<this.children.length;T++)x+=this.children[T].measureTextRecursive(I);return x},this.measureText=function(N){var R=this.parent.style("font-family").getDefinition();if(null!=R){var $=this.parent.style("font-size").numValueOrDefault(b.Font.Parse(b.ctx.font).fontSize),T=0,v=this.getText();R.isRTL&&(v=v.split("").reverse().join(""));for(var J=b.ToNumberArray(this.parent.attribute("dx").value),o=0;o<v.length;o++){var p=this.getGlyph(R,v,o);T+=(p.horizAdvX||R.horizAdvX)*$/R.fontFace.unitsPerEm,"undefined"==typeof J[o]||isNaN(J[o])||(T+=J[o])}return T}var C=b.compressSpaces(this.getText());if(!N.measureText)return 10*C.length;N.save(),this.setContext(N);var E=N.measureText(C).width;return N.restore(),E}},b.Element.TextElementBase.prototype=new b.Element.RenderedElementBase,b.Element.tspan=function(R){this.captureTextNodes=!0,this.base=b.Element.TextElementBase,this.base(R),this.text=b.compressSpaces(R.value||R.text||R.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},b.Element.tspan.prototype=new b.Element.TextElementBase,b.Element.tref=function(k){this.base=b.Element.TextElementBase,this.base(k),this.getText=function(){var H=this.getHrefAttribute().getDefinition();return null!=H?H.children[0].getText():void 0}},b.Element.tref.prototype=new b.Element.TextElementBase,b.Element.a=function(e){this.base=b.Element.TextElementBase,this.base(e),this.hasText=e.childNodes.length>0;for(var C=0;C<e.childNodes.length;C++)3!=e.childNodes[C].nodeType&&(this.hasText=!1);this.text=this.hasText?e.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(T){if(this.hasText){this.baseRenderChildren(T);var I=new b.Property("fontSize",b.Font.Parse(b.ctx.font).fontSize);b.Mouse.checkBoundingBox(this,new b.BoundingBox(this.x,this.y-I.toPixels("y"),this.x+this.measureText(T),this.y))}else if(this.children.length>0){var h=new b.Element.g;h.children=this.children,h.parent=this,h.render(T)}},this.onclick=function(){r.open(this.getHrefAttribute().value)},this.onmousemove=function(){b.ctx.canvas.style.cursor="pointer"}},b.Element.a.prototype=new b.Element.TextElementBase,b.Element.image=function(c){this.base=b.Element.RenderedElementBase,this.base(c);var P=this.getHrefAttribute().value;if(""!=P){var L=P.match(/\.svg$/);if(b.Images.push(this),this.loaded=!1,L)this.img=b.ajax(P),this.loaded=!0;else{this.img=document.createElement("img"),1==b.opts.useCORS&&(this.img.crossOrigin="Anonymous");var v=this;this.img.onload=function(){v.loaded=!0},this.img.onerror=function(){b.log('ERROR: image "'+P+'" not found'),v.loaded=!0},this.img.src=P}this.renderChildren=function(I){var l=this.attribute("x").toPixels("x"),X=this.attribute("y").toPixels("y"),N=this.attribute("width").toPixels("x"),j=this.attribute("height").toPixels("y");0!=N&&0!=j&&(I.save(),L?I.drawSvg(this.img,l,X,N,j):(I.translate(l,X),b.AspectRatio(I,this.attribute("preserveAspectRatio").value,N,this.img.width,j,this.img.height,0,0),I.drawImage(this.img,0,0)),I.restore())},this.getBoundingBox=function(){var s=this.attribute("x").toPixels("x"),p=this.attribute("y").toPixels("y"),h=this.attribute("width").toPixels("x"),G=this.attribute("height").toPixels("y");return new b.BoundingBox(s,p,s+h,p+G)}}},b.Element.image.prototype=new b.Element.RenderedElementBase,b.Element.g=function(q){this.base=b.Element.RenderedElementBase,this.base(q),this.getBoundingBox=function(){for(var y=new b.BoundingBox,H=0;H<this.children.length;H++)y.addBoundingBox(this.children[H].getBoundingBox());return y}},b.Element.g.prototype=new b.Element.RenderedElementBase,b.Element.symbol=function(y){this.base=b.Element.RenderedElementBase,this.base(y),this.render=function(){}},b.Element.symbol.prototype=new b.Element.RenderedElementBase,b.Element.style=function(n){this.base=b.Element.ElementBase,this.base(n);for(var R="",G=0;G<n.childNodes.length;G++)R+=n.childNodes[G].data;R=R.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),R=b.compressSpaces(R);for(var p=R.split("}"),G=0;G<p.length;G++)if(""!=b.trim(p[G]))for(var O=p[G].split("{"),g=O[0].split(","),Z=O[1].split(";"),m=0;m<g.length;m++){var S=b.trim(g[m]);if(""!=S){for(var H=b.Styles[S]||{},r=0;r<Z.length;r++){var v=Z[r].indexOf(":"),s=Z[r].substr(0,v),e=Z[r].substr(v+1,Z[r].length-v);null!=s&&null!=e&&(H[b.trim(s)]=new b.Property(b.trim(s),b.trim(e)))}if(b.Styles[S]=H,b.StylesSpecificity[S]=C(S),"@font-face"==S)for(var u=H["font-family"].value.replace(/"/g,""),T=H.src.value.split(","),I=0;I<T.length;I++)if(T[I].indexOf('format("svg")')>0)for(var a=T[I].indexOf("url"),N=T[I].indexOf(")",a),W=T[I].substr(a+5,N-a-6),z=b.parseXml(b.ajax(W)),c=z.getElementsByTagName("font"),A=0;A<c.length;A++){var h=b.CreateElement(c[A]);b.Definitions[u]=h}}}},b.Element.style.prototype=new b.Element.ElementBase,b.Element.use=function(A){this.base=b.Element.RenderedElementBase,this.base(A),this.baseSetContext=this.setContext,this.setContext=function(T){this.baseSetContext(T),this.attribute("x").hasValue()&&T.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&T.translate(0,this.attribute("y").toPixels("y"))};var J=this.getHrefAttribute().getDefinition();this.path=function(y){null!=J&&J.path(y)},this.getBoundingBox=function(){return null!=J?J.getBoundingBox():void 0},this.renderChildren=function(N){if(null!=J){var z=J;"symbol"==J.type&&(z=new b.Element.svg,z.type="svg",z.attributes.viewBox=new b.Property("viewBox",J.attribute("viewBox").value),z.attributes.preserveAspectRatio=new b.Property("preserveAspectRatio",J.attribute("preserveAspectRatio").value),z.attributes.overflow=new b.Property("overflow",J.attribute("overflow").value),z.children=J.children),"svg"==z.type&&(this.attribute("width").hasValue()&&(z.attributes.width=new b.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(z.attributes.height=new b.Property("height",this.attribute("height").value)));var e=z.parent;z.parent=null,z.render(N),z.parent=e}}},b.Element.use.prototype=new b.Element.RenderedElementBase,b.Element.mask=function(x){this.base=b.Element.ElementBase,this.base(x),this.apply=function(y,s){var N=this.attribute("x").toPixels("x"),w=this.attribute("y").toPixels("y"),Z=this.attribute("width").toPixels("x"),O=this.attribute("height").toPixels("y");if(0==Z&&0==O){for(var c=new b.BoundingBox,t=0;t<this.children.length;t++)c.addBoundingBox(this.children[t].getBoundingBox());var N=Math.floor(c.x1),w=Math.floor(c.y1),Z=Math.floor(c.width()),O=Math.floor(c.height())}var H=s.attribute("mask").value;s.attribute("mask").value="";var C=document.createElement("canvas");C.width=N+Z,C.height=w+O;var U=C.getContext("2d");if(this.renderChildren(U),C.width&&C.height){var V=document.createElement("canvas");V.width=N+Z,V.height=w+O;var q=V.getContext("2d");s.render(q),q.globalCompositeOperation="destination-in",q.fillStyle=U.createPattern(C,"no-repeat"),q.fillRect(0,0,N+Z,w+O),y.fillStyle=q.createPattern(V,"no-repeat"),y.fillRect(0,0,N+Z,w+O),s.attribute("mask").value=H}},this.render=function(){}},b.Element.mask.prototype=new b.Element.ElementBase,b.Element.clipPath=function(f){this.base=b.Element.ElementBase,this.base(f),this.apply=function(Y){var M=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var u=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},M.call(Y);for(var o=0;o<this.children.length;o++){var T=this.children[o];if("undefined"!=typeof T.path){var G=null;T.style("transform",!1,!0).hasValue()&&(G=new b.Transform(T.style("transform",!1,!0).value),G.apply(Y)),T.path(Y),CanvasRenderingContext2D.prototype.closePath=u,G&&G.unapply(Y)}}u.call(Y),Y.clip(),CanvasRenderingContext2D.prototype.beginPath=M,CanvasRenderingContext2D.prototype.closePath=u},this.render=function(){}},b.Element.clipPath.prototype=new b.Element.ElementBase,b.Element.filter=function(u){this.base=b.Element.ElementBase,this.base(u),this.apply=function(s,A){var W=A.getBoundingBox(),D=Math.floor(W.x1),w=Math.floor(W.y1),O=Math.floor(W.width()),Z=Math.floor(W.height()),p=A.style("filter").value;A.style("filter").value="";for(var v=0,g=0,M=0;M<this.children.length;M++){var U=this.children[M].extraFilterDistance||0;v=Math.max(v,U),g=Math.max(g,U)}var S=document.createElement("canvas");S.width=O+2*v,S.height=Z+2*g;var R=S.getContext("2d");R.translate(-D+v,-w+g),A.render(R);for(var M=0;M<this.children.length;M++)"function"==typeof this.children[M].apply&&this.children[M].apply(R,0,0,O+2*v,Z+2*g);s.drawImage(S,0,0,O+2*v,Z+2*g,D-v,w-g,O+2*v,Z+2*g),A.style("filter",!0).value=p},this.render=function(){}},b.Element.filter.prototype=new b.Element.ElementBase,b.Element.feMorphology=function(E){this.base=b.Element.ElementBase,this.base(E),this.apply=function(){}},b.Element.feMorphology.prototype=new b.Element.ElementBase,b.Element.feComposite=function(W){this.base=b.Element.ElementBase,this.base(W),this.apply=function(){}},b.Element.feComposite.prototype=new b.Element.ElementBase,b.Element.feColorMatrix=function(W){function I(f,g,E,r,v,i){return f[4*E*r+4*g+i]}function M(Y,p,s,F,t,q,E){Y[4*s*F+4*p+q]=E}function S(G,l){var B=x[G];return B*(0>B?l-255:l)}this.base=b.Element.ElementBase,this.base(W);var x=b.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var N=x[0];x=[.213+.787*N,.715-.715*N,.072-.072*N,0,0,.213-.213*N,.715+.285*N,.072-.072*N,0,0,.213-.213*N,.715-.715*N,.072+.928*N,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var l=x[0]*Math.PI/180,z=function(Y,w,W){return Y+Math.cos(l)*w+Math.sin(l)*W};x=[z(.213,.787,-.213),z(.715,-.715,-.715),z(.072,-.072,.928),0,0,z(.213,-.213,.143),z(.715,.285,.14),z(.072,-.072,-.283),0,0,z(.213,-.213,-.787),z(.715,-.715,.715),z(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(J,C,w,Q,o){if(Q&&o){for(var D=J.getImageData(0,0,Q,o),w=0;o>w;w++)for(var C=0;Q>C;C++){var k=I(D.data,C,w,Q,o,0),O=I(D.data,C,w,Q,o,1),H=I(D.data,C,w,Q,o,2),r=I(D.data,C,w,Q,o,3);M(D.data,C,w,Q,o,0,S(0,k)+S(1,O)+S(2,H)+S(3,r)+S(4,1)),M(D.data,C,w,Q,o,1,S(5,k)+S(6,O)+S(7,H)+S(8,r)+S(9,1)),M(D.data,C,w,Q,o,2,S(10,k)+S(11,O)+S(12,H)+S(13,r)+S(14,1)),M(D.data,C,w,Q,o,3,S(15,k)+S(16,O)+S(17,H)+S(18,r)+S(19,1))}J.clearRect(0,0,Q,o),J.putImageData(D,0,0)}}},b.Element.feColorMatrix.prototype=new b.Element.ElementBase,b.Element.feGaussianBlur=function(C){this.base=b.Element.ElementBase,this.base(C),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(v,s,I,z,n){return"undefined"==typeof p.canvasRGBA?(b.log("ERROR: StackBlur.js must be included for blur to work"),void 0):(v.canvas.id=b.UniqueId(),v.canvas.style.display="none",document.body.appendChild(v.canvas),p.canvasRGBA(v.canvas.id,s,I,z,n,this.blurRadius),document.body.removeChild(v.canvas),void 0)}},b.Element.feGaussianBlur.prototype=new b.Element.ElementBase,b.Element.title=function(){},b.Element.title.prototype=new b.Element.ElementBase,b.Element.desc=function(){},b.Element.desc.prototype=new b.Element.ElementBase,b.Element.MISSING=function(K){b.log("ERROR: Element '"+K.nodeName+"' not yet implemented.")},b.Element.MISSING.prototype=new b.Element.ElementBase,b.CreateElement=function(I){var O=I.nodeName.replace(/^[^:]+:/,"");O=O.replace(/\-/g,"");var t=null;return t="undefined"!=typeof b.Element[O]?new b.Element[O](I):new b.Element.MISSING(I),t.type=I.nodeName,t},b.load=function(G,B){b.loadXml(G,b.ajax(B))},b.loadXml=function(Y,x){b.loadXmlDoc(Y,b.parseXml(x))},b.loadXmlDoc=function(Y,h){b.init(Y);var m=function(o){for(var W=Y.canvas;W;)o.x-=W.offsetLeft,o.y-=W.offsetTop,W=W.offsetParent;return r.scrollX&&(o.x+=r.scrollX),r.scrollY&&(o.y+=r.scrollY),o};1!=b.opts.ignoreMouse&&(Y.canvas.onclick=function(W){var w=m(new b.Point(null!=W?W.clientX:event.clientX,null!=W?W.clientY:event.clientY));b.Mouse.onclick(w.x,w.y)},Y.canvas.onmousemove=function(k){var E=m(new b.Point(null!=k?k.clientX:event.clientX,null!=k?k.clientY:event.clientY));b.Mouse.onmousemove(E.x,E.y)});var P=b.CreateElement(h.documentElement);P.root=!0,P.addStylesFromStyleDefinition();var g=!0,x=function(){b.ViewPort.Clear(),Y.canvas.parentNode&&b.ViewPort.SetCurrent(Y.canvas.parentNode.clientWidth,Y.canvas.parentNode.clientHeight),1!=b.opts.ignoreDimensions&&(P.style("width").hasValue()&&(Y.canvas.width=P.style("width").toPixels("x"),Y.canvas.style.width=Y.canvas.width+"px"),P.style("height").hasValue()&&(Y.canvas.height=P.style("height").toPixels("y"),Y.canvas.style.height=Y.canvas.height+"px"));var o=Y.canvas.clientWidth||Y.canvas.width,F=Y.canvas.clientHeight||Y.canvas.height;if(1==b.opts.ignoreDimensions&&P.style("width").hasValue()&&P.style("height").hasValue()&&(o=P.style("width").toPixels("x"),F=P.style("height").toPixels("y")),b.ViewPort.SetCurrent(o,F),null!=b.opts.offsetX&&(P.attribute("x",!0).value=b.opts.offsetX),null!=b.opts.offsetY&&(P.attribute("y",!0).value=b.opts.offsetY),null!=b.opts.scaleWidth||null!=b.opts.scaleHeight){var Z=null,N=null,S=b.ToNumberArray(P.attribute("viewBox").value);null!=b.opts.scaleWidth&&(P.attribute("width").hasValue()?Z=P.attribute("width").toPixels("x")/b.opts.scaleWidth:isNaN(S[2])||(Z=S[2]/b.opts.scaleWidth)),null!=b.opts.scaleHeight&&(P.attribute("height").hasValue()?N=P.attribute("height").toPixels("y")/b.opts.scaleHeight:isNaN(S[3])||(N=S[3]/b.opts.scaleHeight)),null==Z&&(Z=N),null==N&&(N=Z),P.attribute("width",!0).value=b.opts.scaleWidth,P.attribute("height",!0).value=b.opts.scaleHeight,P.style("transform",!0,!0).value+=" scale("+1/Z+","+1/N+")"}1!=b.opts.ignoreClear&&Y.clearRect(0,0,o,F),P.render(Y),g&&(g=!1,"function"==typeof b.opts.renderCallback&&b.opts.renderCallback(h))},n=!0;b.ImagesLoaded()&&(n=!1,x()),b.intervalID=setInterval(function(){var D=!1;if(n&&b.ImagesLoaded()&&(n=!1,D=!0),1!=b.opts.ignoreMouse&&(D|=b.Mouse.hasEvents()),1!=b.opts.ignoreAnimation)for(var r=0;r<b.Animations.length;r++)D|=b.Animations[r].update(1e3/b.FRAMERATE);"function"==typeof b.opts.forceRedraw&&1==b.opts.forceRedraw()&&(D=!0),D&&(x(),b.Mouse.runEvents())},1e3/b.FRAMERATE)},b.stop=function(){b.intervalID&&clearInterval(b.intervalID)},b.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(K,P){this.events.push({type:"onclick",x:K,y:P,run:function(D){D.onclick&&D.onclick()}})},this.onmousemove=function(o,u){this.events.push({type:"onmousemove",x:o,y:u,run:function(y){y.onmousemove&&y.onmousemove()}})},this.eventElements=[],this.checkPath=function(Z,A){for(var v=0;v<this.events.length;v++){var E=this.events[v];A.isPointInPath&&A.isPointInPath(E.x,E.y)&&(this.eventElements[v]=Z)}},this.checkBoundingBox=function(q,k){for(var g=0;g<this.events.length;g++){var G=this.events[g];k.isPointInBox(G.x,G.y)&&(this.eventElements[g]=q)}},this.runEvents=function(){b.ctx.canvas.style.cursor="";for(var i=0;i<this.events.length;i++)for(var A=this.events[i],V=this.eventElements[i];V;)A.run(V),V=V.parent;this.events=[],this.eventElements=[]}},b}var K,e=function(T,J,S){if(null!=T||null!=J||null!=S){"string"==typeof T&&(T=document.getElementById(T)),null!=T.svg&&T.svg.stop();var G=b(S||{});(1!=T.childNodes.length||"OBJECT"!=T.childNodes[0].nodeName)&&(T.svg=G);var k=T.getContext("2d");"undefined"!=typeof J.documentElement?G.loadXmlDoc(k,J):"<"==J.substr(0,1)?G.loadXml(k,J):G.load(k,J)}else for(var c=document.querySelectorAll("svg"),v=0;v<c.length;v++){var d=c[v],z=document.createElement("canvas");z.width=d.clientWidth,z.height=d.clientHeight,d.parentNode.insertBefore(z,d),d.parentNode.removeChild(d);var o=document.createElement("div");o.appendChild(d),e(z,o.innerHTML)}};"undefined"!=typeof Element.prototype.matches?K=function(s,k){return s.matches(k)}:"undefined"!=typeof Element.prototype.webkitMatchesSelector?K=function(b,s){return b.webkitMatchesSelector(s)}:"undefined"!=typeof Element.prototype.mozMatchesSelector?K=function(q,D){return q.mozMatchesSelector(D)}:"undefined"!=typeof Element.prototype.msMatchesSelector?K=function(X,c){return X.msMatchesSelector(c)}:"undefined"!=typeof Element.prototype.oMatchesSelector?K=function(y,B){return y.oMatchesSelector(B)}:(("function"==typeof jQuery||"function"==typeof Zepto)&&(K=function(J,Q){return $(J).is(Q)}),"undefined"==typeof K&&(K=Sizzle.matchesSelector));var Y=/(\[[^\]]+\])/g,h=/(#[^\s\+>~\.\[:]+)/g,x=/(\.[^\s\+>~\.\[:]+)/g,W=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,f=/(:[\w-]+\([^\)]*\))/gi,E=/(:[^\s\+>~\.\[:]+)/g,B=/([^\s\+>~\.\[:]+)/g;return"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(t,O,N,o,J,C){var n={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:O,offsetY:N,scaleWidth:o,scaleHeight:J};for(var B in C)C.hasOwnProperty(B)&&(n[B]=C[B]);e(this.canvas,t,n)}),e})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);